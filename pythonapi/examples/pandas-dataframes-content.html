<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Generate Input Files &mdash; OpenMC Documentation</title>
    
    <link rel="stylesheet" href="../../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="OpenMC Documentation" href="../../index.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner">
        <a href="../../index.html">
          <img class="logo" src="../../_static/openmc.png" alt="Logo"/>
        </a>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <p>This notebook demonstrates how systematic analysis of tally scores is
possible using Pandas dataframes. A dataframe can be automatically
generated using the <code class="docutils literal"><span class="pre">Tally.get_pandas_dataframe(...)</span></code> method.
Furthermore, by linking the tally data in a statepoint file with
geometry and material information from a summary file, the dataframe can
be shown with user-supplied labels.</p>
<p><strong>Note:</strong> that this Notebook was created using the latest Pandas
v0.16.1. Everything in the Notebook will wun with older versions of
Pandas, but the multi-indexing option in &gt;v0.15.0 makes the tables look
prettier.</p>
<div class="code python highlight-python"><div class="highlight"><pre>import glob
from IPython.display import Image
import matplotlib.pylab as pylab
import scipy.stats
import numpy as np

import openmc
from openmc.statepoint import StatePoint
from openmc.summary import Summary

%matplotlib inline
</pre></div>
</div>
<div class="section" id="generate-input-files">
<h1>Generate Input Files<a class="headerlink" href="#generate-input-files" title="Permalink to this headline">Â¶</a></h1>
<p>First we need to define materials that will be used in the problem.
Before defining a material, we must create nuclides that are used in the
material.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate some Nuclides</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;H-1&#39;</span><span class="p">)</span>
<span class="n">b10</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;B-10&#39;</span><span class="p">)</span>
<span class="n">o16</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;O-16&#39;</span><span class="p">)</span>
<span class="n">u235</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;U-235&#39;</span><span class="p">)</span>
<span class="n">u238</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;U-238&#39;</span><span class="p">)</span>
<span class="n">zr90</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Nuclide</span><span class="p">(</span><span class="s">&#39;Zr-90&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the nuclides we defined, we will now create three materials for the
fuel, water, and cladding of the fuel pin.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># 1.6 enriched fuel</span>
<span class="n">fuel</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6</span><span class="si">% F</span><span class="s">uel&#39;</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">set_density</span><span class="p">(</span><span class="s">&#39;g/cm3&#39;</span><span class="p">,</span> <span class="mf">10.31341</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">u235</span><span class="p">,</span> <span class="mf">3.7503e-4</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">u238</span><span class="p">,</span> <span class="mf">2.2625e-2</span><span class="p">)</span>
<span class="n">fuel</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">o16</span><span class="p">,</span> <span class="mf">4.6007e-2</span><span class="p">)</span>

<span class="c"># borated water</span>
<span class="n">water</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Borated Water&#39;</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">set_density</span><span class="p">(</span><span class="s">&#39;g/cm3&#39;</span><span class="p">,</span> <span class="mf">0.740582</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">h1</span><span class="p">,</span> <span class="mf">4.9457e-2</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">o16</span><span class="p">,</span> <span class="mf">2.4732e-2</span><span class="p">)</span>
<span class="n">water</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">b10</span><span class="p">,</span> <span class="mf">8.0042e-6</span><span class="p">)</span>

<span class="c"># zircaloy</span>
<span class="n">zircaloy</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Zircaloy&#39;</span><span class="p">)</span>
<span class="n">zircaloy</span><span class="o">.</span><span class="n">set_density</span><span class="p">(</span><span class="s">&#39;g/cm3&#39;</span><span class="p">,</span> <span class="mf">6.55</span><span class="p">)</span>
<span class="n">zircaloy</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">zr90</span><span class="p">,</span> <span class="mf">7.2758e-3</span><span class="p">)</span>
</pre></div>
</div>
<p>With our three materials, we can now create a materials file object that
can be exported to an actual XML file.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate a MaterialsFile, add Materials</span>
<span class="n">materials_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">MaterialsFile</span><span class="p">()</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">add_material</span><span class="p">(</span><span class="n">fuel</span><span class="p">)</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">add_material</span><span class="p">(</span><span class="n">water</span><span class="p">)</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">add_material</span><span class="p">(</span><span class="n">zircaloy</span><span class="p">)</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">default_xs</span> <span class="o">=</span> <span class="s">&#39;71c&#39;</span>

<span class="c"># Export to &quot;materials.xml&quot;</span>
<span class="n">materials_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>Now let&#8217;s move on to the geometry. This problem will be a square array
of fuel pins for which we can use OpenMC&#8217;s lattice/universe feature. The
basic universe will have three regions for the fuel, the clad, and the
surrounding coolant. The first step is to create the bounding surfaces
for fuel and clad, as well as the outer bounding surfaces of the
problem.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create cylinders for the fuel and clad</span>
<span class="n">fuel_outer_radius</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZCylinder</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mf">0.39218</span><span class="p">)</span>
<span class="n">clad_outer_radius</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZCylinder</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="mf">0.45720</span><span class="p">)</span>

<span class="c"># Create boundary planes to surround the geometry</span>
<span class="c"># Use both reflective and vacuum boundaries to make life interesting</span>
<span class="n">min_x</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">XPlane</span><span class="p">(</span><span class="n">x0</span><span class="o">=-</span><span class="mf">10.71</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">max_x</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">XPlane</span><span class="p">(</span><span class="n">x0</span><span class="o">=+</span><span class="mf">10.71</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;vacuum&#39;</span><span class="p">)</span>
<span class="n">min_y</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">YPlane</span><span class="p">(</span><span class="n">y0</span><span class="o">=-</span><span class="mf">10.71</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;vacuum&#39;</span><span class="p">)</span>
<span class="n">max_y</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">YPlane</span><span class="p">(</span><span class="n">y0</span><span class="o">=+</span><span class="mf">10.71</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">min_z</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZPlane</span><span class="p">(</span><span class="n">z0</span><span class="o">=-</span><span class="mf">10.71</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
<span class="n">max_z</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">ZPlane</span><span class="p">(</span><span class="n">z0</span><span class="o">=+</span><span class="mf">10.71</span><span class="p">,</span> <span class="n">boundary_type</span><span class="o">=</span><span class="s">&#39;reflective&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the surfaces defined, we can now construct a fuel pin cell from
cells that are defined by intersections of half-spaces created by the
surfaces.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create a Universe to encapsulate a fuel pin</span>
<span class="n">pin_cell_universe</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6</span><span class="si">% F</span><span class="s">uel Pin&#39;</span><span class="p">)</span>

<span class="c"># Create fuel Cell</span>
<span class="n">fuel_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6</span><span class="si">% F</span><span class="s">uel&#39;</span><span class="p">)</span>
<span class="n">fuel_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">fuel</span>
<span class="n">fuel_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">-</span><span class="n">fuel_outer_radius</span>
<span class="n">pin_cell_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">fuel_cell</span><span class="p">)</span>

<span class="c"># Create a clad Cell</span>
<span class="n">clad_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6% Clad&#39;</span><span class="p">)</span>
<span class="n">clad_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">zircaloy</span>
<span class="n">clad_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">+</span><span class="n">fuel_outer_radius</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">clad_outer_radius</span>
<span class="n">pin_cell_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">clad_cell</span><span class="p">)</span>

<span class="c"># Create a moderator Cell</span>
<span class="n">moderator_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6% Moderator&#39;</span><span class="p">)</span>
<span class="n">moderator_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">water</span>
<span class="n">moderator_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">+</span><span class="n">clad_outer_radius</span>
<span class="n">pin_cell_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">moderator_cell</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the pin cell universe, we can construct a 17x17 rectangular
lattice with a 1.26 cm pitch.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create fuel assembly Lattice</span>
<span class="n">assembly</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">RectLattice</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;1.6</span><span class="si">% F</span><span class="s">uel - 0BA&#39;</span><span class="p">)</span>
<span class="n">assembly</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">)</span>
<span class="n">assembly</span><span class="o">.</span><span class="n">pitch</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.26</span><span class="p">,</span> <span class="mf">1.26</span><span class="p">)</span>
<span class="n">assembly</span><span class="o">.</span><span class="n">lower_left</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.26</span> <span class="o">*</span> <span class="mf">17.</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">assembly</span><span class="o">.</span><span class="n">universes</span> <span class="o">=</span> <span class="p">[[</span><span class="n">pin_cell_universe</span><span class="p">]</span> <span class="o">*</span> <span class="mi">17</span><span class="p">]</span> <span class="o">*</span> <span class="mi">17</span>
</pre></div>
</div>
<p>OpenMC requires that there is a &#8220;root&#8221; universe. Let us create a root
cell that is filled by the pin cell universe and then assign it to the
root universe.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create root Cell</span>
<span class="n">root_cell</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Cell</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;root cell&#39;</span><span class="p">)</span>
<span class="n">root_cell</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="n">assembly</span>

<span class="c"># Add boundary planes</span>
<span class="n">root_cell</span><span class="o">.</span><span class="n">region</span> <span class="o">=</span> <span class="o">+</span><span class="n">min_x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">max_x</span> <span class="o">&amp;</span> <span class="o">+</span><span class="n">min_y</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">max_y</span> <span class="o">&amp;</span> <span class="o">+</span><span class="n">min_z</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">max_z</span>

<span class="c"># Create root Universe</span>
<span class="n">root_universe</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Universe</span><span class="p">(</span><span class="n">universe_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;root universe&#39;</span><span class="p">)</span>
<span class="n">root_universe</span><span class="o">.</span><span class="n">add_cell</span><span class="p">(</span><span class="n">root_cell</span><span class="p">)</span>
</pre></div>
</div>
<p>We now must create a geometry that is assigned a root universe, put the
geometry into a <code class="docutils literal"><span class="pre">GeometryFile</span></code> object, and export it to XML.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create Geometry and set root Universe</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Geometry</span><span class="p">()</span>
<span class="n">geometry</span><span class="o">.</span><span class="n">root_universe</span> <span class="o">=</span> <span class="n">root_universe</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate a GeometryFile</span>
<span class="n">geometry_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">GeometryFile</span><span class="p">()</span>
<span class="n">geometry_file</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span>

<span class="c"># Export to &quot;geometry.xml&quot;</span>
<span class="n">geometry_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>With the geometry and materials finished, we now just need to define
simulation parameters. In this case, we will use 5 inactive batches and
15 minimum active batches each with 2500 particles. We also tell OpenMC
to turn tally triggers on, which means it will keep running until some
criterion on the uncertainty of tallies is reached.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># OpenMC simulation parameters</span>
<span class="n">min_batches</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">max_batches</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">inactive</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">particles</span> <span class="o">=</span> <span class="mi">2500</span>

<span class="c"># Instantiate a SettingsFile</span>
<span class="n">settings_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">SettingsFile</span><span class="p">()</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">batches</span> <span class="o">=</span> <span class="n">min_batches</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">inactive</span> <span class="o">=</span> <span class="n">inactive</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">particles</span> <span class="o">=</span> <span class="n">particles</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;tallies&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;summary&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">trigger_active</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">trigger_max_batches</span> <span class="o">=</span> <span class="n">max_batches</span>
<span class="n">source_bounds</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">10.71</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.71</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mf">10.71</span><span class="p">,</span> <span class="mf">10.71</span><span class="p">,</span> <span class="mf">10.</span><span class="p">]</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">set_source_space</span><span class="p">(</span><span class="s">&#39;box&#39;</span><span class="p">,</span> <span class="n">source_bounds</span><span class="p">)</span>

<span class="c"># Export to &quot;settings.xml&quot;</span>
<span class="n">settings_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>Let us also create a plot file that we can use to verify that our pin
cell geometry was created successfully.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate a Plot</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">plot_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plot</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;materials-xy&#39;</span>
<span class="n">plot</span><span class="o">.</span><span class="n">origin</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">plot</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="p">[</span><span class="mf">21.5</span><span class="p">,</span> <span class="mf">21.5</span><span class="p">]</span>
<span class="n">plot</span><span class="o">.</span><span class="n">pixels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span> <span class="mi">250</span><span class="p">]</span>
<span class="n">plot</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s">&#39;mat&#39;</span>

<span class="c"># Instantiate a PlotsFile, add Plot, and export to &quot;plots.xml&quot;</span>
<span class="n">plot_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">PlotsFile</span><span class="p">()</span>
<span class="n">plot_file</span><span class="o">.</span><span class="n">add_plot</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="n">plot_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>With the plots.xml file, we can now generate and view the plot. OpenMC
outputs plots in .ppm format, which can be converted into a compressed
format like .png with the convert utility.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Run openmc in plotting mode</span>
<span class="n">executor</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Executor</span><span class="p">()</span>
<span class="n">executor</span><span class="o">.</span><span class="n">plot_geometry</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">0</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre># Convert OpenMC&#39;s funky ppm to png
!convert materials-xy.ppm materials-xy.png

# Display the materials plot inline
Image(filename=&#39;materials-xy.png&#39;)
</pre></div>
</div>
<img alt="../../_images/pandas-dataframes-content_26_0.png" src="../../_images/pandas-dataframes-content_26_0.png" />
<p>As we can see from the plot, we have a nice array of pin cells with
fuel, cladding, and water! Before we run our simulation, we need to tell
the code what we want to tally. The following code shows how to create a
variety of tallies.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate an empty TalliesFile</span>
<span class="n">tallies_file</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">TalliesFile</span><span class="p">()</span>
<span class="n">tallies_file</span><span class="o">.</span><span class="n">_tallies</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Instantiate a fission rate mesh Tally</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate a tally Mesh</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">mesh_id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;regular&#39;</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">dimension</span> <span class="o">=</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">]</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">lower_left</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">10.71</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.71</span><span class="p">]</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.26</span><span class="p">,</span> <span class="mf">1.26</span><span class="p">]</span>

<span class="c"># Instantiate tally Filter</span>
<span class="n">mesh_filter</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Filter</span><span class="p">()</span>
<span class="n">mesh_filter</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>

<span class="c"># Instantiate energy Filter</span>
<span class="n">energy_filter</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Filter</span><span class="p">()</span>
<span class="n">energy_filter</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&#39;energy&#39;</span>
<span class="n">energy_filter</span><span class="o">.</span><span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.625e-6</span><span class="p">,</span> <span class="mf">20.</span><span class="p">])</span>

<span class="c"># Instantiate the Tally</span>
<span class="n">tally</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Tally</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;mesh tally&#39;</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">mesh_filter</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">energy_filter</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_score</span><span class="p">(</span><span class="s">&#39;fission&#39;</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_score</span><span class="p">(</span><span class="s">&#39;nu-fission&#39;</span><span class="p">)</span>

<span class="c"># Add mesh and Tally to TalliesFile</span>
<span class="n">tallies_file</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
<span class="n">tallies_file</span><span class="o">.</span><span class="n">add_tally</span><span class="p">(</span><span class="n">tally</span><span class="p">)</span>
</pre></div>
</div>
<p>Instantiate a cell Tally with nuclides</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate tally Filter</span>
<span class="n">cell_filter</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;cell&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="n">fuel_cell</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

<span class="c"># Instantiate the tally</span>
<span class="n">tally</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Tally</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;cell tally&#39;</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">cell_filter</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_score</span><span class="p">(</span><span class="s">&#39;scatter-y2&#39;</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">u235</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_nuclide</span><span class="p">(</span><span class="n">u238</span><span class="p">)</span>

<span class="c"># Add mesh and tally to TalliesFile</span>
<span class="n">tallies_file</span><span class="o">.</span><span class="n">add_tally</span><span class="p">(</span><span class="n">tally</span><span class="p">)</span>
</pre></div>
</div>
<p>Create a &#8220;distribcell&#8221; Tally. The distribcell filter allows us to tally
multiple repeated instances of the same cell throughout the geometry.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Instantiate tally Filter</span>
<span class="n">distribcell_filter</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Filter</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;distribcell&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="n">moderator_cell</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

<span class="c"># Instantiate tally Trigger for kicks</span>
<span class="n">trigger</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Trigger</span><span class="p">(</span><span class="n">trigger_type</span><span class="o">=</span><span class="s">&#39;std_dev&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">5e-5</span><span class="p">)</span>
<span class="n">trigger</span><span class="o">.</span><span class="n">add_score</span><span class="p">(</span><span class="s">&#39;absorption&#39;</span><span class="p">)</span>

<span class="c"># Instantiate the Tally</span>
<span class="n">tally</span> <span class="o">=</span> <span class="n">openmc</span><span class="o">.</span><span class="n">Tally</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;distribcell tally&#39;</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_filter</span><span class="p">(</span><span class="n">distribcell_filter</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_score</span><span class="p">(</span><span class="s">&#39;absorption&#39;</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_score</span><span class="p">(</span><span class="s">&#39;scatter&#39;</span><span class="p">)</span>
<span class="n">tally</span><span class="o">.</span><span class="n">add_trigger</span><span class="p">(</span><span class="n">trigger</span><span class="p">)</span>

<span class="c"># Add mesh and tally to TalliesFile</span>
<span class="n">tallies_file</span><span class="o">.</span><span class="n">add_tally</span><span class="p">(</span><span class="n">tally</span><span class="p">)</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Export to &quot;tallies.xml&quot;</span>
<span class="n">tallies_file</span><span class="o">.</span><span class="n">export_to_xml</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we a have a complete set of inputs, so we can go ahead and run our
simulation.</p>
<div class="code python highlight-python"><div class="highlight"><pre># Remove old HDF5 (summary, statepoint) files
!rm statepoint.*

# Run OpenMC with MPI!
executor.run_simulation()
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>       .d88888b.                             888b     d888  .d8888b.
      d88P&quot; &quot;Y88b                            8888b   d8888 d88P  Y88b
      888     888                            88888b.d88888 888    888
      888     888 88888b.   .d88b.  88888b.  888Y88888P888 888
      888     888 888 &quot;88b d8P  Y8b 888 &quot;88b 888 Y888P 888 888
      888     888 888  888 88888888 888  888 888  Y8P  888 888    888
      Y88b. .d88P 888 d88P Y8b.     888  888 888   &quot;   888 Y88b  d88P
       &quot;Y88888P&quot;  88888P&quot;   &quot;Y8888  888  888 888       888  &quot;Y8888P&quot;
__________________888______________________________________________________
                  888
                  888

      Copyright:      2011-2015 Massachusetts Institute of Technology
      License:        http://mit-crpg.github.io/openmc/license.html
      Version:        0.7.0
      Git SHA1:       21738db07debeabde824c9b955bd3bf0c9a16366
      Date/Time:      2015-10-28 20:55:18
      MPI Processes:  1

 ===========================================================================
 ========================&gt;     INITIALIZATION     &lt;=========================
 ===========================================================================

 Reading settings XML file...
 Reading cross sections XML file...
 Reading geometry XML file...
 Reading materials XML file...
 Reading tallies XML file...
 Building neighboring cells lists for each surface...
 Loading ACE cross section table: 92235.71c
 Loading ACE cross section table: 92238.71c
 Loading ACE cross section table: 8016.71c
 Loading ACE cross section table: 1001.71c
 Loading ACE cross section table: 5010.71c
 Loading ACE cross section table: 40090.71c
 Maximum neutron transport energy: 20.0000 MeV for 92235.71c
 Initializing source particles...

 ===========================================================================
 ====================&gt;     K EIGENVALUE SIMULATION     &lt;====================
 ===========================================================================

  Bat./Gen.      k            Average k
  =========   ========   ====================
        1/1    0.54958
        2/1    0.67628
        3/1    0.70618
        4/1    0.66601
        5/1    0.70876
        6/1    0.69708
        7/1    0.68623    0.69166 +/- 0.00543
        8/1    0.69159    0.69163 +/- 0.00313
        9/1    0.69908    0.69349 +/- 0.00289
       10/1    0.63865    0.68253 +/- 0.01120
       11/1    0.65439    0.67784 +/- 0.01027
       12/1    0.68518    0.67889 +/- 0.00875
       13/1    0.69507    0.68091 +/- 0.00784
       14/1    0.70129    0.68317 +/- 0.00728
       15/1    0.71336    0.68619 +/- 0.00717
       16/1    0.68725    0.68629 +/- 0.00649
       17/1    0.72579    0.68958 +/- 0.00678
       18/1    0.67149    0.68819 +/- 0.00639
       19/1    0.67771    0.68744 +/- 0.00596
       20/1    0.68035    0.68697 +/- 0.00557
 Triggers unsatisfied, max unc./thresh. is 1.09851 for absorption in tally 10002
 The estimated number of batches is 24
 Creating state point statepoint.020.h5...
       21/1    0.68105    0.68660 +/- 0.00522
       22/1    0.67168    0.68572 +/- 0.00498
       23/1    0.67520    0.68514 +/- 0.00473
       24/1    0.67940    0.68483 +/- 0.00449
 Triggers satisfied for batch 24
 Creating state point statepoint.024.h5...

 ===========================================================================
 ======================&gt;     SIMULATION FINISHED     &lt;======================
 ===========================================================================


 =======================&gt;     TIMING STATISTICS     &lt;=======================

 Total time for initialization     =  7.3800E-01 seconds
   Reading cross sections          =  1.5600E-01 seconds
 Total time in simulation          =  1.5998E+01 seconds
   Time in transport only          =  1.5965E+01 seconds
   Time in inactive batches        =  2.3990E+00 seconds
   Time in active batches          =  1.3599E+01 seconds
   Time synchronizing fission bank =  3.0000E-03 seconds
     Sampling source sites         =  1.0000E-03 seconds
     SEND/RECV source sites        =  2.0000E-03 seconds
   Time accumulating tallies       =  3.0000E-03 seconds
 Total time for finalization       =  0.0000E+00 seconds
 Total time elapsed                =  1.6754E+01 seconds
 Calculation Rate (inactive)       =  5210.50 neutrons/second
 Calculation Rate (active)         =  2757.56 neutrons/second

 ============================&gt;     RESULTS     &lt;============================

 k-effective (Collision)     =  0.68264 +/-  0.00405
 k-effective (Track-length)  =  0.68483 +/-  0.00449
 k-effective (Absorption)    =  0.68225 +/-  0.00336
 Combined k-effective        =  0.68275 +/-  0.00346
 Leakage Fraction            =  0.34345 +/-  0.00167
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="tally-data-processing">
<h1>Tally Data Processing<a class="headerlink" href="#tally-data-processing" title="Permalink to this headline">Â¶</a></h1>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># We do not know how many batches were needed to satisfy the</span>
<span class="c"># tally trigger(s), so find the statepoint file(s)</span>
<span class="n">statepoints</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;statepoint.*.h5&#39;</span><span class="p">)</span>

<span class="c"># Load the last statepoint file</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">StatePoint</span><span class="p">(</span><span class="n">statepoints</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Load the summary file and link with statepoint</span>
<span class="n">su</span> <span class="o">=</span> <span class="n">Summary</span><span class="p">(</span><span class="s">&#39;summary.h5&#39;</span><span class="p">)</span>
<span class="n">sp</span><span class="o">.</span><span class="n">link_with_summary</span><span class="p">(</span><span class="n">su</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Analyze the mesh fission rate tally</strong></p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Find the mesh tally with the StatePoint API</span>
<span class="n">tally</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_tally</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;mesh tally&#39;</span><span class="p">)</span>

<span class="c"># Print a little info about the mesh tally to the screen</span>
<span class="k">print</span><span class="p">(</span><span class="n">tally</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Tally
    ID             =        10000
    Name           =        mesh tally
    Filters        =
                            mesh    [1]
                            energy  [  0.00000000e+00   6.25000000e-07   2.00000000e+01]
    Nuclides       =        total
    Scores         =        [u&#39;fission&#39;, u&#39;nu-fission&#39;]
    Estimator      =        tracklength
</pre></div>
</div>
<p>Use the new Tally data retrieval API with pure NumPy</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Get the relative error for the thermal fission reaction</span>
<span class="c"># rates in the four corner pins</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">scores</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;fission&#39;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;mesh&#39;</span><span class="p">,</span> <span class="s">&#39;energy&#39;</span><span class="p">],</span> \
                        <span class="n">filter_bins</span><span class="o">=</span><span class="p">[((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">)),</span> \
                                    <span class="p">((</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.625e-6</span><span class="p">),)],</span> <span class="n">value</span><span class="o">=</span><span class="s">&#39;rel_err&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[[[</span> <span class="mf">0.18257268</span><span class="p">]]</span>

 <span class="p">[[</span> <span class="mf">0.07111957</span><span class="p">]]</span>

 <span class="p">[[</span> <span class="mf">0.40880276</span><span class="p">]]</span>

 <span class="p">[[</span> <span class="mf">0.16407535</span><span class="p">]]]</span>
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Get a pandas dataframe for the mesh tally data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">get_pandas_dataframe</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># Print the first twenty rows in the dataframe</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">mesh 1</th>
      <th>energy [MeV]</th>
      <th>score</th>
      <th>mean</th>
      <th>std. dev.</th>
    </tr>
    <tr>
      <th></th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>(0.0e+00 - 6.3e-07)</td>
      <td>fission</td>
      <td>0.000202</td>
      <td>0.000037</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>(0.0e+00 - 6.3e-07)</td>
      <td>nu-fission</td>
      <td>0.000492</td>
      <td>0.000090</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>(6.3e-07 - 2.0e+01)</td>
      <td>fission</td>
      <td>0.000076</td>
      <td>0.000004</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>(6.3e-07 - 2.0e+01)</td>
      <td>nu-fission</td>
      <td>0.000204</td>
      <td>0.000010</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>(0.0e+00 - 6.3e-07)</td>
      <td>fission</td>
      <td>0.000375</td>
      <td>0.000039</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>(0.0e+00 - 6.3e-07)</td>
      <td>nu-fission</td>
      <td>0.000914</td>
      <td>0.000094</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>(6.3e-07 - 2.0e+01)</td>
      <td>fission</td>
      <td>0.000107</td>
      <td>0.000013</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>(6.3e-07 - 2.0e+01)</td>
      <td>nu-fission</td>
      <td>0.000278</td>
      <td>0.000032</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>(0.0e+00 - 6.3e-07)</td>
      <td>fission</td>
      <td>0.000564</td>
      <td>0.000056</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>(0.0e+00 - 6.3e-07)</td>
      <td>nu-fission</td>
      <td>0.001374</td>
      <td>0.000137</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>(6.3e-07 - 2.0e+01)</td>
      <td>fission</td>
      <td>0.000149</td>
      <td>0.000007</td>
    </tr>
    <tr>
      <th>11</th>
      <td>1</td>
      <td>3</td>
      <td>1</td>
      <td>(6.3e-07 - 2.0e+01)</td>
      <td>nu-fission</td>
      <td>0.000388</td>
      <td>0.000018</td>
    </tr>
    <tr>
      <th>12</th>
      <td>1</td>
      <td>4</td>
      <td>1</td>
      <td>(0.0e+00 - 6.3e-07)</td>
      <td>fission</td>
      <td>0.000669</td>
      <td>0.000044</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1</td>
      <td>4</td>
      <td>1</td>
      <td>(0.0e+00 - 6.3e-07)</td>
      <td>nu-fission</td>
      <td>0.001631</td>
      <td>0.000108</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1</td>
      <td>4</td>
      <td>1</td>
      <td>(6.3e-07 - 2.0e+01)</td>
      <td>fission</td>
      <td>0.000165</td>
      <td>0.000011</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1</td>
      <td>4</td>
      <td>1</td>
      <td>(6.3e-07 - 2.0e+01)</td>
      <td>nu-fission</td>
      <td>0.000433</td>
      <td>0.000029</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>(0.0e+00 - 6.3e-07)</td>
      <td>fission</td>
      <td>0.000932</td>
      <td>0.000069</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>(0.0e+00 - 6.3e-07)</td>
      <td>nu-fission</td>
      <td>0.002270</td>
      <td>0.000168</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>(6.3e-07 - 2.0e+01)</td>
      <td>fission</td>
      <td>0.000183</td>
      <td>0.000011</td>
    </tr>
    <tr>
      <th>19</th>
      <td>1</td>
      <td>5</td>
      <td>1</td>
      <td>(6.3e-07 - 2.0e+01)</td>
      <td>nu-fission</td>
      <td>0.000477</td>
      <td>0.000028</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Create a boxplot to view the distribution of</span>
<span class="c"># fission and nu-fission rates in the pins</span>
<span class="n">bp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">column</span><span class="o">=</span><span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="s">&#39;score&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/pandas-dataframes-content_46_0.png" src="../../_images/pandas-dataframes-content_46_0.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Extract thermal nu-fission rates from pandas</span>
<span class="n">fiss</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;nu-fission&#39;</span><span class="p">]</span>
<span class="n">fiss</span> <span class="o">=</span> <span class="n">fiss</span><span class="p">[</span><span class="n">fiss</span><span class="p">[</span><span class="s">&#39;energy [MeV]&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;(0.0e+00 - 6.3e-07)&#39;</span><span class="p">]</span>

<span class="c"># Extract mean and reshape as 2D NumPy arrays</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">fiss</span><span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">17</span><span class="p">,</span><span class="mi">17</span><span class="p">))</span>

<span class="n">pylab</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;fission rate&#39;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.colorbar.Colorbar instance at 0x7fdb2d6d5680&gt;
</pre></div>
</div>
<img alt="../../_images/pandas-dataframes-content_47_1.png" src="../../_images/pandas-dataframes-content_47_1.png" />
<p><strong>Analyze the cell+nuclides scatter-y2 rate tally</strong></p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Find the cell Tally with the StatePoint API</span>
<span class="n">tally</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_tally</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;cell tally&#39;</span><span class="p">)</span>

<span class="c"># Print a little info about the cell tally to the screen</span>
<span class="k">print</span><span class="p">(</span><span class="n">tally</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Tally
    ID             =        10001
    Name           =        cell tally
    Filters        =
                            cell    [10000]
    Nuclides       =        U-235 U-238
    Scores         =        [u&#39;scatter-Y0,0&#39;, u&#39;scatter-Y1,-1&#39;, u&#39;scatter-Y1,0&#39;, u&#39;scatter-Y1,1&#39;, u&#39;scatter-Y2,-2&#39;, u&#39;scatter-Y2,-1&#39;, u&#39;scatter-Y2,0&#39;, u&#39;scatter-Y2,1&#39;, u&#39;scatter-Y2,2&#39;]
    Estimator      =        analog
</pre></div>
</div>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Get a pandas dataframe for the cell tally data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">get_pandas_dataframe</span><span class="p">()</span>

<span class="c"># Print the first twenty rows in the dataframe</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cell</th>
      <th>nuclide</th>
      <th>score</th>
      <th>mean</th>
      <th>std. dev.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10000</td>
      <td>U-235</td>
      <td>scatter-Y0,0</td>
      <td>0.037095</td>
      <td>0.001150</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10000</td>
      <td>U-235</td>
      <td>scatter-Y1,-1</td>
      <td>0.000266</td>
      <td>0.000323</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10000</td>
      <td>U-235</td>
      <td>scatter-Y1,0</td>
      <td>-0.000417</td>
      <td>0.000274</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10000</td>
      <td>U-235</td>
      <td>scatter-Y1,1</td>
      <td>-0.000228</td>
      <td>0.000237</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10000</td>
      <td>U-235</td>
      <td>scatter-Y2,-2</td>
      <td>0.000026</td>
      <td>0.000199</td>
    </tr>
    <tr>
      <th>5</th>
      <td>10000</td>
      <td>U-235</td>
      <td>scatter-Y2,-1</td>
      <td>-0.000115</td>
      <td>0.000185</td>
    </tr>
    <tr>
      <th>6</th>
      <td>10000</td>
      <td>U-235</td>
      <td>scatter-Y2,0</td>
      <td>0.000151</td>
      <td>0.000159</td>
    </tr>
    <tr>
      <th>7</th>
      <td>10000</td>
      <td>U-235</td>
      <td>scatter-Y2,1</td>
      <td>-0.000122</td>
      <td>0.000280</td>
    </tr>
    <tr>
      <th>8</th>
      <td>10000</td>
      <td>U-235</td>
      <td>scatter-Y2,2</td>
      <td>0.000008</td>
      <td>0.000181</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10000</td>
      <td>U-238</td>
      <td>scatter-Y0,0</td>
      <td>2.328632</td>
      <td>0.013107</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10000</td>
      <td>U-238</td>
      <td>scatter-Y1,-1</td>
      <td>0.024530</td>
      <td>0.002272</td>
    </tr>
    <tr>
      <th>11</th>
      <td>10000</td>
      <td>U-238</td>
      <td>scatter-Y1,0</td>
      <td>-0.000059</td>
      <td>0.002804</td>
    </tr>
    <tr>
      <th>12</th>
      <td>10000</td>
      <td>U-238</td>
      <td>scatter-Y1,1</td>
      <td>-0.027990</td>
      <td>0.002536</td>
    </tr>
    <tr>
      <th>13</th>
      <td>10000</td>
      <td>U-238</td>
      <td>scatter-Y2,-2</td>
      <td>-0.004861</td>
      <td>0.001575</td>
    </tr>
    <tr>
      <th>14</th>
      <td>10000</td>
      <td>U-238</td>
      <td>scatter-Y2,-1</td>
      <td>0.000557</td>
      <td>0.002018</td>
    </tr>
    <tr>
      <th>15</th>
      <td>10000</td>
      <td>U-238</td>
      <td>scatter-Y2,0</td>
      <td>0.006236</td>
      <td>0.001627</td>
    </tr>
    <tr>
      <th>16</th>
      <td>10000</td>
      <td>U-238</td>
      <td>scatter-Y2,1</td>
      <td>-0.000648</td>
      <td>0.001551</td>
    </tr>
    <tr>
      <th>17</th>
      <td>10000</td>
      <td>U-238</td>
      <td>scatter-Y2,2</td>
      <td>-0.001031</td>
      <td>0.001310</td>
    </tr>
  </tbody>
</table>
</div><p>Use the new Tally data retrieval API with pure NumPy</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Get the standard deviations for two of the spherical harmonic</span>
<span class="c"># scattering reaction rates</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">scores</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;scatter-Y2,2&#39;</span><span class="p">,</span> <span class="s">&#39;scatter-Y0,0&#39;</span><span class="p">],</span>
                        <span class="n">nuclides</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;U-238&#39;</span><span class="p">,</span> <span class="s">&#39;U-235&#39;</span><span class="p">],</span> <span class="n">value</span><span class="o">=</span><span class="s">&#39;std_dev&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>[[[ 0.00131009  0.01310707]
  [ 0.00018089  0.00114976]]]
</pre></div>
</div>
<p><strong>Analyze the distribcell tally</strong></p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Find the distribcell Tally with the StatePoint API</span>
<span class="n">tally</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_tally</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;distribcell tally&#39;</span><span class="p">)</span>

<span class="c"># Print a little info about the distribcell tally to the screen</span>
<span class="k">print</span><span class="p">(</span><span class="n">tally</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Tally
    ID             =        10002
    Name           =        distribcell tally
    Filters        =
                            distribcell     [10002]
    Nuclides       =        total
    Scores         =        [u&#39;absorption&#39;, u&#39;scatter&#39;]
    Estimator      =        tracklength
</pre></div>
</div>
<p>Use the new Tally data retrieval API with pure NumPy</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Get the relative error for the scattering reaction rates in</span>
<span class="c"># the first 30 distribcell instances</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">scores</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;scatter&#39;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;distribcell&#39;</span><span class="p">],</span>
                        <span class="n">filter_bins</span><span class="o">=</span><span class="p">[(</span><span class="n">i</span><span class="p">,)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)],</span> <span class="n">value</span><span class="o">=</span><span class="s">&#39;rel_err&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[[[</span> <span class="mf">0.04537029</span><span class="p">]]]</span>
</pre></div>
</div>
<p>Print the distribcell tally dataframe <strong>without</strong> OpenCG info</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Get a pandas dataframe for the distribcell tally data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">get_pandas_dataframe</span><span class="p">(</span><span class="n">nuclides</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># Print the last twenty rows in the dataframe</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>distribcell</th>
      <th>score</th>
      <th>mean</th>
      <th>std. dev.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>558</th>
      <td>279</td>
      <td>absorption</td>
      <td>0.000093</td>
      <td>0.000013</td>
    </tr>
    <tr>
      <th>559</th>
      <td>279</td>
      <td>scatter</td>
      <td>0.013504</td>
      <td>0.000805</td>
    </tr>
    <tr>
      <th>560</th>
      <td>280</td>
      <td>absorption</td>
      <td>0.000084</td>
      <td>0.000010</td>
    </tr>
    <tr>
      <th>561</th>
      <td>280</td>
      <td>scatter</td>
      <td>0.014215</td>
      <td>0.000612</td>
    </tr>
    <tr>
      <th>562</th>
      <td>281</td>
      <td>absorption</td>
      <td>0.000091</td>
      <td>0.000008</td>
    </tr>
    <tr>
      <th>563</th>
      <td>281</td>
      <td>scatter</td>
      <td>0.014545</td>
      <td>0.000590</td>
    </tr>
    <tr>
      <th>564</th>
      <td>282</td>
      <td>absorption</td>
      <td>0.000112</td>
      <td>0.000012</td>
    </tr>
    <tr>
      <th>565</th>
      <td>282</td>
      <td>scatter</td>
      <td>0.016321</td>
      <td>0.000729</td>
    </tr>
    <tr>
      <th>566</th>
      <td>283</td>
      <td>absorption</td>
      <td>0.000092</td>
      <td>0.000007</td>
    </tr>
    <tr>
      <th>567</th>
      <td>283</td>
      <td>scatter</td>
      <td>0.016163</td>
      <td>0.000661</td>
    </tr>
    <tr>
      <th>568</th>
      <td>284</td>
      <td>absorption</td>
      <td>0.000104</td>
      <td>0.000011</td>
    </tr>
    <tr>
      <th>569</th>
      <td>284</td>
      <td>scatter</td>
      <td>0.017384</td>
      <td>0.000599</td>
    </tr>
    <tr>
      <th>570</th>
      <td>285</td>
      <td>absorption</td>
      <td>0.000111</td>
      <td>0.000011</td>
    </tr>
    <tr>
      <th>571</th>
      <td>285</td>
      <td>scatter</td>
      <td>0.018015</td>
      <td>0.000774</td>
    </tr>
    <tr>
      <th>572</th>
      <td>286</td>
      <td>absorption</td>
      <td>0.000125</td>
      <td>0.000012</td>
    </tr>
    <tr>
      <th>573</th>
      <td>286</td>
      <td>scatter</td>
      <td>0.018294</td>
      <td>0.000828</td>
    </tr>
    <tr>
      <th>574</th>
      <td>287</td>
      <td>absorption</td>
      <td>0.000119</td>
      <td>0.000013</td>
    </tr>
    <tr>
      <th>575</th>
      <td>287</td>
      <td>scatter</td>
      <td>0.017483</td>
      <td>0.000757</td>
    </tr>
    <tr>
      <th>576</th>
      <td>288</td>
      <td>absorption</td>
      <td>0.000113</td>
      <td>0.000014</td>
    </tr>
    <tr>
      <th>577</th>
      <td>288</td>
      <td>scatter</td>
      <td>0.018248</td>
      <td>0.000782</td>
    </tr>
  </tbody>
</table>
</div><p>Print the distribcell tally dataframe <strong>with</strong> OpenCG info</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Get a pandas dataframe for the distribcell tally data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">tally</span><span class="o">.</span><span class="n">get_pandas_dataframe</span><span class="p">(</span><span class="n">summary</span><span class="o">=</span><span class="n">su</span><span class="p">,</span> <span class="n">nuclides</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># Print the last twenty rows in the dataframe</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">level 1</th>
      <th colspan="4" halign="left">level 2</th>
      <th colspan="2" halign="left">level 3</th>
      <th>distribcell</th>
      <th>score</th>
      <th>mean</th>
      <th>std. dev.</th>
    </tr>
    <tr>
      <th></th>
      <th>cell</th>
      <th>univ</th>
      <th colspan="4" halign="left">lat</th>
      <th>cell</th>
      <th>univ</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th>id</th>
      <th>id</th>
      <th>id</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
      <th>id</th>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>0</td>
      <td>absorption</td>
      <td>0.000123</td>
      <td>0.000012</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>0</td>
      <td>scatter</td>
      <td>0.017805</td>
      <td>0.000808</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>1</td>
      <td>absorption</td>
      <td>0.000217</td>
      <td>0.000020</td>
    </tr>
    <tr>
      <th>3</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>1</td>
      <td>scatter</td>
      <td>0.028867</td>
      <td>0.001263</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>2</td>
      <td>absorption</td>
      <td>0.000318</td>
      <td>0.000020</td>
    </tr>
    <tr>
      <th>5</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>2</td>
      <td>scatter</td>
      <td>0.040493</td>
      <td>0.001269</td>
    </tr>
    <tr>
      <th>6</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>3</td>
      <td>absorption</td>
      <td>0.000386</td>
      <td>0.000018</td>
    </tr>
    <tr>
      <th>7</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>3</td>
      <td>scatter</td>
      <td>0.048576</td>
      <td>0.001337</td>
    </tr>
    <tr>
      <th>8</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>4</td>
      <td>absorption</td>
      <td>0.000501</td>
      <td>0.000026</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>4</td>
      <td>scatter</td>
      <td>0.057063</td>
      <td>0.001715</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>5</td>
      <td>absorption</td>
      <td>0.000484</td>
      <td>0.000026</td>
    </tr>
    <tr>
      <th>11</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>5</td>
      <td>scatter</td>
      <td>0.060822</td>
      <td>0.001581</td>
    </tr>
    <tr>
      <th>12</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>6</td>
      <td>absorption</td>
      <td>0.000532</td>
      <td>0.000039</td>
    </tr>
    <tr>
      <th>13</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>6</td>
      <td>scatter</td>
      <td>0.069101</td>
      <td>0.002249</td>
    </tr>
    <tr>
      <th>14</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>7</td>
      <td>absorption</td>
      <td>0.000577</td>
      <td>0.000039</td>
    </tr>
    <tr>
      <th>15</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>7</td>
      <td>scatter</td>
      <td>0.076722</td>
      <td>0.002335</td>
    </tr>
    <tr>
      <th>16</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>8</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>8</td>
      <td>absorption</td>
      <td>0.000649</td>
      <td>0.000039</td>
    </tr>
    <tr>
      <th>17</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>8</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>8</td>
      <td>scatter</td>
      <td>0.081564</td>
      <td>0.001610</td>
    </tr>
    <tr>
      <th>18</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>9</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>9</td>
      <td>absorption</td>
      <td>0.000680</td>
      <td>0.000032</td>
    </tr>
    <tr>
      <th>19</th>
      <td>10003</td>
      <td>0</td>
      <td>10001</td>
      <td>9</td>
      <td>0</td>
      <td>0</td>
      <td>10002</td>
      <td>10000</td>
      <td>9</td>
      <td>scatter</td>
      <td>0.087715</td>
      <td>0.001959</td>
    </tr>
  </tbody>
</table>
</div><div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Show summary statistics for absorption distribcell tally data</span>
<span class="n">absorption</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;absorption&#39;</span><span class="p">]</span>
<span class="n">absorption</span><span class="p">[[</span><span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="s">&#39;std. dev.&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

<span class="c"># Note that the maximum standard deviation does indeed</span>
<span class="c"># meet the 5e-4 threshold set by the tally trigger</span>
</pre></div>
</div>
<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th>mean</th>
      <th>std. dev.</th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>289.000000</td>
      <td>289.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.000418</td>
      <td>0.000022</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.000239</td>
      <td>0.000009</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000018</td>
      <td>0.000004</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000202</td>
      <td>0.000015</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.000402</td>
      <td>0.000021</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.000615</td>
      <td>0.000027</td>
    </tr>
    <tr>
      <th>max</th>
      <td>0.000892</td>
      <td>0.000044</td>
    </tr>
  </tbody>
</table>
</div><p>Perform a statistical test comparing the tally sample distributions for
two categories of fuel pins.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Extract tally data from pins in the pins divided along y=x diagonal</span>
<span class="n">multi_index</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;level 2&#39;</span><span class="p">,</span> <span class="s">&#39;lat&#39;</span><span class="p">,)</span>
<span class="n">lower</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">multi_index</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,)]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="n">multi_index</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,)]</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">multi_index</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,)]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="n">multi_index</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,)]</span> <span class="o">&gt;</span> <span class="mi">16</span><span class="p">]</span>
<span class="n">lower</span> <span class="o">=</span> <span class="n">lower</span><span class="p">[</span><span class="n">lower</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;absorption&#39;</span><span class="p">]</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">upper</span><span class="p">[</span><span class="n">upper</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;absorption&#39;</span><span class="p">]</span>

<span class="c"># Perform non-parametric Mann-Whitney U Test to see if the</span>
<span class="c"># absorption rates (may) come from same sampling distribution</span>
<span class="n">u</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">lower</span><span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">],</span> <span class="n">upper</span><span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Mann-Whitney Test p-value: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Mann-Whitney Test p-value: 0.414863173548
</pre></div>
</div>
<p>Note that the symmetry implied by the y=x diagonal ensures that the two
sampling distributions are identical. Indeed, as illustrated by the test
above, for any reasonable significance level (<em>e.g.</em>,
<span class="math">\(\alpha\)</span>=0.05) one would <strong>not reject</strong> the null hypothesis that
the two sampling distributions are identical.</p>
<p>Next, perform the same test but with two groupings of pins which are not
symmetrically identical to one another.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Extract tally data from pins in the pins divided along y=-x diagonal</span>
<span class="n">multi_index</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;level 2&#39;</span><span class="p">,</span> <span class="s">&#39;lat&#39;</span><span class="p">,)</span>
<span class="n">lower</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">multi_index</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,)]</span> <span class="o">&gt;</span> <span class="n">df</span><span class="p">[</span><span class="n">multi_index</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,)]]</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">multi_index</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,)]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="n">multi_index</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,)]]</span>
<span class="n">lower</span> <span class="o">=</span> <span class="n">lower</span><span class="p">[</span><span class="n">lower</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;absorption&#39;</span><span class="p">]</span>
<span class="n">upper</span> <span class="o">=</span> <span class="n">upper</span><span class="p">[</span><span class="n">upper</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;absorption&#39;</span><span class="p">]</span>

<span class="c"># Perform non-parametric Mann-Whitney U Test to see if the</span>
<span class="c"># absorption rates (may) come from same sampling distribution</span>
<span class="n">u</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span><span class="n">lower</span><span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">],</span> <span class="n">upper</span><span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;Mann-Whitney Test p-value: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>Mann-Whitney Test p-value: 3.28554363741e-42
</pre></div>
</div>
<p>Note that the asymmetry implied by the y=-x diagonal ensures that the
two sampling distributions are <em>not</em> identical. Indeed, as illustrated
by the test above, for any reasonable significance level (<em>e.g.</em>,
<span class="math">\(\alpha\)</span>=0.05) one would <strong>reject</strong> the null hypothesis that the
two sampling distributions are identical.</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Extract the scatter tally data from pandas</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s">&#39;score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;scatter&#39;</span><span class="p">]</span>

<span class="n">scatter</span><span class="p">[</span><span class="s">&#39;rel. err.&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scatter</span><span class="p">[</span><span class="s">&#39;std. dev.&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">scatter</span><span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">]</span>

<span class="c"># Show a scatter plot of the mean vs. the std. dev.</span>
<span class="n">scatter</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">&#39;mean&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&#39;rel. err.&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Scattering Rates&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>/usr/local/lib/python2.7/dist-packages/IPython/kernel/__main__.py:4: SettingWithCopyWarning:
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the the caveats in the documentation: http://pandas.pydata.org/pandas-docs/stable/indexing.html#indexing-view-versus-copy
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.axes.AxesSubplot at 0x7fdb2d5c3e10&gt;
</pre></div>
</div>
<img alt="../../_images/pandas-dataframes-content_67_2.png" src="../../_images/pandas-dataframes-content_67_2.png" />
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Plot a histogram and kernel density estimate for the scattering rates</span>
<span class="n">scatter</span><span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;hist&#39;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">scatter</span><span class="p">[</span><span class="s">&#39;mean&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s">&#39;kde&#39;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&#39;Scattering Rates&#39;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Mean&#39;</span><span class="p">)</span>
<span class="n">pylab</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;KDE&#39;</span><span class="p">,</span> <span class="s">&#39;Histogram&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre>&lt;matplotlib.legend.Legend at 0x7fdb2d555390&gt;
</pre></div>
</div>
<img alt="../../_images/pandas-dataframes-content_68_1.png" src="../../_images/pandas-dataframes-content_68_1.png" />
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        <a class="uplink" href="../../index.html">Contents</a>
        </p>

      </div>


    <div class="footer" role="contentinfo">
        &copy; Copyright 2011-2015, Massachusetts Institute of Technology.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.3.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30411614-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>