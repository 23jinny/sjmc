<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>6. Tallies &mdash; OpenMC Documentation</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpenMC Documentation" href="../index.html" />
    <link rel="up" title="Theory and Methodology" href="index.html" />
    <link rel="next" title="7. Eigenvalue Calculations" href="eigenvalue.html" />
    <link rel="prev" title="5. Physics" href="physics.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner">
        <a href="../index.html">
          <img class="logo" src="../_static/openmc.png" alt="Logo"/>
        </a>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="physics.html">5. Physics</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="eigenvalue.html">7. Eigenvalue Calculations</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="tallies">
<span id="methods-tallies"></span><h1>6. Tallies<a class="headerlink" href="#tallies" title="Permalink to this headline">¶</a></h1>
<div class="section" id="filters-and-scores">
<h2>6.1. Filters and Scores<a class="headerlink" href="#filters-and-scores" title="Permalink to this headline">¶</a></h2>
<p>The tally capability in OpenMC takes a similar philosophy as that employed in
the <a class="reference external" href="http://www.osti.gov/bridge/servlets/purl/903083-HT5p1o/903083.pdf">MC21</a> Monte Carlo code to give maximum flexibility in specifying tallies
while still maintaining scalability. Any tally in a Monte Carlo simulation can
be written in the following form:</p>
<div class="math" id="equation-tally-integral">
<p><span class="eqno">(1)</span><img src="../_images/math/29d4af4f962546248fbf0b1af83dc19f73ea7af0.png" alt="X = \underbrace{\int d\mathbf{r} \int d\mathbf{\Omega} \int
dE}_{\text{filters}} \underbrace{f(\mathbf{r}, \mathbf{\Omega},
E)}_{\text{scores}} \psi (\mathbf{r}, \mathbf{\Omega}, E)"/></p>
</div><p>A user can specify one or more filters which identify which regions of phase
space should score to a given tally (the limits of integration as shown in
equation <a href="#equation-tally-integral">(1)</a>) as well as the scoring function (<img class="math" src="../_images/math/0001d02b63ede2fe3219e05a7cd09c82ae6298b6.png" alt="f"/> in
equation <a href="#equation-tally-integral">(1)</a>). For example, if the desired tally was the
<img class="math" src="../_images/math/86a337316c6571ab2d3380e2bc1735c09def19dc.png" alt="(n,\gamma)"/> reaction rate in a fuel pin, the filter would specify the
cell which contains the fuel pin and the scoring function would be the radiative
capture macroscopic cross section. The following quantities can be scored in
OpenMC: flux, total reaction rate, scattering reaction rate, neutron production
from scattering, higher scattering moments, <img class="math" src="../_images/math/86812743fd2241a6d3211913c9f5c801e4abde62.png" alt="(n,xn)"/> reaction rates,
absorption reaction rate, fission reaction rate, neutron production rate from
fission, and surface currents. The following variables can be used as filters:
universe, material, cell, birth cell, surface, mesh, pre-collision energy, and
post-collision energy.</p>
<p>With filters for pre- and post-collision energy and scoring functions for
scattering and fission production, it is possible to use OpenMC to generate
cross sections with user-defined group structures. These multigroup cross
sections can subsequently be used in deterministic solvers such as coarse mesh
finite difference (CMFD) diffusion.</p>
</div>
<div class="section" id="using-maps-for-filter-matching">
<h2>6.2. Using Maps for Filter-Matching<a class="headerlink" href="#using-maps-for-filter-matching" title="Permalink to this headline">¶</a></h2>
<p>Some Monte Carlo codes suffer severe performance penalties when tallying a large
number of quantities. Care must be taken to ensure that a tally system scales
well with the total number of tally bins. In OpenMC, a mapping technique is used
that allows for a fast determination of what tally/bin combinations need to be
scored to a given particle&#8217;s phase space coordinates. For each discrete filter
variable, a list is stored that contains the tally/bin combinations that could
be scored to for each value of the filter variable. If a particle is in cell
<img class="math" src="../_images/math/413f8a8e40062a9090d9d50b88bc7b551b314c26.png" alt="n"/>, the mapping would identify what tally/bin combinations specify cell
<img class="math" src="../_images/math/413f8a8e40062a9090d9d50b88bc7b551b314c26.png" alt="n"/> for the cell filter variable. In this manner, it is not necessary to
check the phase space variables against each tally. Note that this technique
only applies to discrete filter variables and cannot be applied to energy
bins. For energy filters, it is necessary to perform a binary search on the
specified energy grid.</p>
</div>
<div class="section" id="volume-integrated-flux-and-reaction-rates">
<h2>6.3. Volume-Integrated Flux and Reaction Rates<a class="headerlink" href="#volume-integrated-flux-and-reaction-rates" title="Permalink to this headline">¶</a></h2>
<p>One quantity we may wish to compute during the course of a Monte Carlo
simulation is the flux or a reaction rate integrated over a finite volume. The
volume may be a particular cell, a collection of cells, or the entire
geometry. There are various methods by which we can estimate reaction rates</p>
<div class="section" id="analog-estimator">
<h3>6.3.1. Analog Estimator<a class="headerlink" href="#analog-estimator" title="Permalink to this headline">¶</a></h3>
<p>The analog estimator is the simplest type of estimator for reaction rates. The
basic idea is that we simply count the number of actual reactions that take
place and use that as our estimate for the reaction rate. This can be written
mathematically as</p>
<div class="math" id="equation-analog-estimator">
<p><span class="eqno">(2)</span><img src="../_images/math/a1ce9f29dab59ec91154466e8ae8281cd6871e21.png" alt="R_x = \frac{1}{W} \sum_{i \in A} w_i"/></p>
</div><p>where <img class="math" src="../_images/math/73d277ae6306fb2c824312f5919d8671da448cf7.png" alt="R_x"/> is the reaction rate for reaction <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/>, <img class="math" src="../_images/math/a581f053bbfa5115f42c13094857cdd12a37ec49.png" alt="i"/> denotes
an index for each event, <img class="math" src="../_images/math/0acafa529182e79b4f56165ec677554fba7fcf98.png" alt="A"/> is the set of all events resulting in
reaction <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/>, and <img class="math" src="../_images/math/fa34489cf430b7630b30f28b2eb050e2489e3523.png" alt="W"/> is the total starting weight of the particles,
and <img class="math" src="../_images/math/b4e1bc8e2dfd2c26158273aef285b08a816f960a.png" alt="w_i"/> is the pre-collision weight of the particle as it enters event
<img class="math" src="../_images/math/a581f053bbfa5115f42c13094857cdd12a37ec49.png" alt="i"/>. One should note that equation <a href="#equation-analog-estimator">(2)</a> is
volume-integrated so if we want a volume-averaged quantity, we need to divided
by the volume of the region of integration. If survival biasing is employed, the
analog estimator cannot be used for any reactions with zero neutrons in the exit
channel.</p>
</div>
<div class="section" id="collision-estimator">
<h3>6.3.2. Collision Estimator<a class="headerlink" href="#collision-estimator" title="Permalink to this headline">¶</a></h3>
<p>While the analog estimator is conceptually very simple and easy to implement, it
can suffer higher variance due to the fact low probability events will not occur
often enough to get good statistics if they are being tallied. Thus, it is
desirable to use a different estimator that allows us to score to the tally more
often. One such estimator is the collision estimator. Instead of tallying a
reaction only when it happens, the idea is to make a contribution to the tally
at every collision.</p>
<p>We can start by writing a formula for the collision estimate of the flux. Since
<img class="math" src="../_images/math/e0c1c7ee8111c03c6aa7da153d8e0fb19bc3dfd6.png" alt="R = \Sigma_t \phi"/> where <img class="math" src="../_images/math/9d86170e7de539c0ff999de09621ee0c7b6c8ed0.png" alt="R"/> is the total reaction rate,
<img class="math" src="../_images/math/6e5a1041d6cc18eff2b55b18f087de59f2ed28df.png" alt="\Sigma_t"/> is the total macroscopic cross section, and <img class="math" src="../_images/math/10e009bdb83f96c5f47c58b34d5d4b12ef268d5b.png" alt="\phi"/> is the
scalar flux, it stands to reason that we can estimate the flux by taking an
estimate of the total reaction rate and dividing it by the total macroscopic
cross section. This gives us the following formula:</p>
<div class="math" id="equation-collision-estimator-flux">
<p><span class="eqno">(3)</span><img src="../_images/math/bfe57c96935377a67170c7ba05b6aeab4d769345.png" alt="\phi = \frac{1}{W} \sum_{i \in C} \frac{w_i}{\Sigma_t (E_i)}"/></p>
</div><p>where <img class="math" src="../_images/math/fa34489cf430b7630b30f28b2eb050e2489e3523.png" alt="W"/> is again the total starting weight of the particles, <img class="math" src="../_images/math/2bcc65482aa8e15cd4c9e9f2542451fb4e971a91.png" alt="C"/>
is the set of all events resulting in a collision with a nucleus, and
<img class="math" src="../_images/math/5596e22c6a95f7867261c9c03287f5b55a07009d.png" alt="\Sigma_t (E)"/> is the total macroscopic cross section of the target
material at the incoming energy of the particle <img class="math" src="../_images/math/b027139ad09fca3ca4adfe7d1149b9b2a69dbe3a.png" alt="E_i"/>.</p>
<p>If we multiply both sides of equation <a href="#equation-collision-estimator-flux">(3)</a> by the
macroscopic cross section for some reaction <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/>, then we get the collision
estimate for the reaction rate for that reaction:</p>
<div class="math" id="equation-collision-estimator">
<p><span class="eqno">(4)</span><img src="../_images/math/7db73590716d06f31345abe7eb6bbf3c88592801.png" alt="R_x = \frac{1}{W} \sum_{i \in C} \frac{w_i \Sigma_x (E_i)}{\Sigma_t (E_i)}"/></p>
</div><p>where <img class="math" src="../_images/math/d3752480013ffb470e055e9556ab284aafc51ebe.png" alt="\Sigma_x (E_i)"/> is the macroscopic cross section for reaction
<img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> at the incoming energy of the particle <img class="math" src="../_images/math/b027139ad09fca3ca4adfe7d1149b9b2a69dbe3a.png" alt="E_i"/>. In comparison to
equation <a href="#equation-analog-estimator">(2)</a>, we see that the collision estimate will result
in a tally with a larger number of events that score to it with smaller
contributions (since we have multiplied it by <img class="math" src="../_images/math/37becb468222e6ac16a7540b83bcefc3773471b6.png" alt="\Sigma_x / \Sigma_t"/>).</p>
</div>
<div class="section" id="track-length-estimator">
<h3>6.3.3. Track-length Estimator<a class="headerlink" href="#track-length-estimator" title="Permalink to this headline">¶</a></h3>
<p>One other method we can use to increase the number of events that scores to
tallies is to use an estimator the scores contributions to a tally at every
track for the particle rather than every collision. This is known as a
track-length estimator, sometimes also called a path-length estimator. We first
start with an expression for the volume integrated flux, which can be written as</p>
<div class="math" id="equation-flux-integrated">
<p><span class="eqno">(5)</span><img src="../_images/math/d36b141653b3cd788cab1ceec40f54fc5dde0d77.png" alt="V \phi = \int d\mathbf{r} \int dE \int d\mathbf{\Omega} \int dt \,
\psi(\mathbf{r}, \mathbf{\hat{\Omega}}, E, t)"/></p>
</div><p>where <img class="math" src="../_images/math/c99df7a209495334da442b1ec998abaabfa320d8.png" alt="V"/> is the volume, <img class="math" src="../_images/math/1a52481ac36eb889dcbbdcc0783ba2a755ba3547.png" alt="\psi"/> is the angular flux,
<img class="math" src="../_images/math/8071ff334721ab012d25650ac4095eec5ac776fe.png" alt="\mathbf{r}"/> is the position of the particle, <img class="math" src="../_images/math/1fe11817fe9ad6255e3961c7a3f4098ca66d33a3.png" alt="\mathbf{\hat{\Omega}}"/>
is the direction of the particle, <img class="math" src="../_images/math/cfd13a0f26eb7ef0093319a7669da7dd3771dbac.png" alt="E"/> is the energy of the particle, and
<img class="math" src="../_images/math/ef9270877405055756d345facd044e4ab297f858.png" alt="t"/> is the time. By noting that <img class="math" src="../_images/math/410dcdb09a912ada08d501569194bbd5b1374da2.png" alt="\psi(\mathbf{r},
\mathbf{\hat{\Omega}}, E, t) = v n(\mathbf{r}, \mathbf{\hat{\Omega}}, E, t)"/>
where <img class="math" src="../_images/math/413f8a8e40062a9090d9d50b88bc7b551b314c26.png" alt="n"/> is the angular neutron density, we can rewrite equation
<a href="#equation-flux-integrated">(5)</a> as</p>
<div class="math" id="equation-flux-integrated-2">
<p><span class="eqno">(6)</span><img src="../_images/math/1b825b02abfae6f41473d2e13c1986ed29da6a0f.png" alt="V \phi = \int d\mathbf{r} \int dE \int dt v \int d\mathbf{\Omega} \, n(\mathbf{r},
\mathbf{\hat{\Omega}}, E, t))."/></p>
</div><p>Using the relations <img class="math" src="../_images/math/fd7b44db5c3ad98d514be8b183781853e1e76c74.png" alt="N(\mathbf{r}, E, t) = \int d\mathbf{\Omega}
n(\mathbf{r}, \mathbf{\hat{\Omega}}, E, t)"/> and <img class="math" src="../_images/math/bf96627c574a89031435dbca37bbb0754a23a3d5.png" alt="d\ell = v \, dt"/> where
<img class="math" src="../_images/math/a0f849f2110868f6cb280a21dd6f6fb1533cb2a6.png" alt="d\ell"/> is the differential unit of track length, we then obtain</p>
<div class="math" id="equation-track-length-integral">
<p><span class="eqno">(7)</span><img src="../_images/math/4e2c11e8c608c5dbcf13fc09449292744c46558d.png" alt="V \phi = \int d\mathbf{r} \int dE \int d\ell N(\mathbf{r}, E, t)."/></p>
</div><p>Equation <a href="#equation-track-length-integral">(7)</a> indicates that we can use the length of a
particle&#8217;s trajectory as an estimate for the flux, i.e. the track-length
estimator of the flux would be</p>
<div class="math" id="equation-track-length-flux">
<p><span class="eqno">(8)</span><img src="../_images/math/3ab53407882dbe27e33193ce4bc64e09a3f3e831.png" alt="\phi = \frac{1}{W} \sum_{i \in T} w_i \ell_i"/></p>
</div><p>where <img class="math" src="../_images/math/6d42c88506b8da39a2a23653aecbfb7c29728063.png" alt="T"/> is the set of all the particle&#8217;s trajectories within the desired
volume and <img class="math" src="../_images/math/83fc9cf9e57ab2efd684555607bc04421dca79c7.png" alt="\ell_i"/> is the length of the <img class="math" src="../_images/math/a581f053bbfa5115f42c13094857cdd12a37ec49.png" alt="i"/>-th trajectory. In the
same vein as equation <a href="#equation-collision-estimator">(4)</a>, the track-length estimate of a
reaction rate is found by multiplying equation <a href="#equation-track-length-flux">(8)</a> by a
macroscopic reaction cross section:</p>
<div class="math" id="equation-track-length-estimator">
<p><span class="eqno">(9)</span><img src="../_images/math/94e2854f988985e477127962f26f39c7181a6b97.png" alt="R_x = \frac{1}{W} \sum_{i \in T} w_i \ell_i \Sigma_x (E_i)."/></p>
</div><p>One important fact to take into consideration is that the use of a track-length
estimator precludes us from using any filter that requires knowledge of the
particle&#8217;s state following a collision because by definition, it will not have
had a collision at every event. Thus, for tallies with outgoing-energy filters
(which require the post-collision energy) or for tallies of scattering moments
(which require the scattering cosine), we must use an analog estimator.</p>
</div>
</div>
<div class="section" id="statistics">
<h2>6.4. Statistics<a class="headerlink" href="#statistics" title="Permalink to this headline">¶</a></h2>
<p>As was discussed briefly in <a class="reference internal" href="introduction.html#methods-introduction"><span>Introduction</span></a>, any given result from a
Monte Carlo calculation, colloquially known as a &#8220;tally&#8221;, represents an estimate
of the mean of some <a class="reference external" href="http://en.wikipedia.org/wiki/Random_variable">random variable</a> of interest. This random variable
typically corresponds to some physical quantity like a reaction rate, a net
current across some surface, or the neutron flux in a region. Given that all
tallies are produced by a <a class="reference external" href="http://en.wikipedia.org/wiki/Stochastic_process">stochastic process</a>, there is an associated
uncertainty with each value reported. It is important to understand how the
uncertainty is calculated and what it tells us about our results. To that end,
we will introduce a number of theorems and results from statistics that should
shed some light on the interpretation of uncertainties.</p>
<div class="section" id="law-of-large-numbers">
<h3>6.4.1. Law of Large Numbers<a class="headerlink" href="#law-of-large-numbers" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="http://en.wikipedia.org/wiki/Law_of_large_numbers">law of large numbers</a> is an important statistical result that tells us
that the average value of the result a large number of repeated experiments
should be close to the <a class="reference external" href="http://en.wikipedia.org/wiki/Expected_value">expected value</a>. Let <img class="math" src="../_images/math/3e6e31e0452d9ce5c1cbf1a8e5d89df4e8ea9b30.png" alt="X_1, X_2, \dots, X_n"/> be an
infinite sequence of <a class="reference external" href="http://en.wikipedia.org/wiki/Independent_and_identically_distributed_random_variables">independent, identically-distributed random variables</a>
with expected values <img class="math" src="../_images/math/ff565d3b79da742989ea5e5bf3a7f51222d3e2f0.png" alt="E(X_1) = E(X_2) = \mu"/>. One form of the law of large
numbers states that the sample mean <img class="math" src="../_images/math/75edee3f73619d38eccbb9a39a88557f0eb2b2a9.png" alt="\bar{X_n} = \frac{X_1 + \dots +
X_n}{n}"/> <a class="reference external" href="http://en.wikipedia.org/wiki/Convergence_of_random_variables#Convergence_in_probability">converges in probability</a> to the true mean, i.e. for all
<img class="math" src="../_images/math/defc8dedc4e1c71aa65da56c385f2d8681f2ed4d.png" alt="\epsilon &gt; 0"/></p>
<div class="math">
<p><img src="../_images/math/0e9e284d7d60207230c1feca26f48a82442a4f37.png" alt="\lim\limits_{n\rightarrow\infty} P \left ( \left | \bar{X}_n - \mu \right |
\ge \epsilon \right ) = 0."/></p>
</div></div>
<div class="section" id="central-limit-theorem">
<span id="id1"></span><h3>6.4.2. Central Limit Theorem<a class="headerlink" href="#central-limit-theorem" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="#id1">central limit theorem</a> (CLT) is perhaps the most well-known and ubiquitous
statistical theorem that has far-reaching implications across many
disciplines. The CLT is similar to the law of large numbers in that it tells us
the limiting behavior of the sample mean. Whereas the law of large numbers tells
us only that the value of the sample mean will converge to the expected value of
the distribution, the CLT says that the distribution of the sample mean will
converge to a <a class="reference external" href="http://en.wikipedia.org/wiki/Normal_distribution">normal distribution</a>. As we defined before, let <img class="math" src="../_images/math/9102c2943033ce76d9c6f8f88a9dcd512d8e97b7.png" alt="X_1, X_2,
\dots, X_n"/> be an infinite sequence of independent, identically-distributed
random variables with expected values <img class="math" src="../_images/math/8033c031b846e26a221944f8a8e242e54fee4ac5.png" alt="E(X_i) = \mu"/> and variances
<img class="math" src="../_images/math/12b8af51623eeb2d930b8f84d0210abf9eb9516d.png" alt="\text{Var} (X_i) = \sigma^2 &lt; \infty"/>. Note that we don&#8217;t require that
these random variables take on any particular distribution &#8211; they can be
normal, log-normal, Weibull, etc. The central limit theorem states that as
<img class="math" src="../_images/math/940cc04250d65618093ae95efc888b0d7f0b8059.png" alt="n \rightarrow \infty"/>, the random variable <img class="math" src="../_images/math/1cbd5f2a0906bdc57c21d9136d949ae49710fe7b.png" alt="\sqrt{n} (\bar{X}_n -
\mu)"/> <a class="reference external" href="http://en.wikipedia.org/wiki/Convergence_of_random_variables#Convergence_in_distribution">converges in distribution</a> to the standard normal distribution:</p>
<div class="math" id="equation-central-limit-theorem">
<p><span class="eqno">(10)</span><img src="../_images/math/45f7406a4b0cdcd45b9986f83b72661b29eb3858.png" alt="\sqrt{n} \left ( \frac{1}{n} \sum_{i=1}^n X_i - \mu \right ) \xrightarrow{d}
\mathcal{N} (0, \sigma^2)"/></p>
</div></div>
<div class="section" id="estimating-statistics-of-a-random-variable">
<h3>6.4.3. Estimating Statistics of a Random Variable<a class="headerlink" href="#estimating-statistics-of-a-random-variable" title="Permalink to this headline">¶</a></h3>
<div class="section" id="mean">
<h4>6.4.3.1. Mean<a class="headerlink" href="#mean" title="Permalink to this headline">¶</a></h4>
<p>Given independent samples drawn from a random variable, the sample mean is
simply an estimate of the average value of the random variable. In a Monte Carlo
simulation, the random variable represents physical quantities that we want
tallied. If <img class="math" src="../_images/math/f026aecf11ec7f6141ab863f260d395f94b10f51.png" alt="X"/> is the random variable with <img class="math" src="../_images/math/75e27f04188974063be3230dca208cd495b77ce1.png" alt="N"/> observations
<img class="math" src="../_images/math/570903dbf7ac37848a90dbabfc4dc2975ff713bb.png" alt="x_1, x_2, \dots, x_N"/>, then an unbiased estimator for the population mean
is the sample mean, defined as</p>
<div class="math" id="equation-sample-mean">
<p><span class="eqno">(11)</span><img src="../_images/math/f0792c32b45049f1aef67e0092bd8262ca3d6516.png" alt="\bar{x} = \frac{1}{N} \sum_{i=1}^N x_i."/></p>
</div></div>
<div class="section" id="variance">
<h4>6.4.3.2. Variance<a class="headerlink" href="#variance" title="Permalink to this headline">¶</a></h4>
<p>The variance of a population indicates how spread out different members of the
population are. For a Monte Carlo simulation, the variance of a tally is a
measure of how precisely we know the tally value, with a lower variance
indicating a higher precision. There are a few different estimators for the
population variance. One of these is the second central moment of the
distribution also known as the biased sample variance:</p>
<div class="math" id="equation-biased-variance">
<p><span class="eqno">(12)</span><img src="../_images/math/9cce1a5e965d290e2b9dddc109266533adbfec61.png" alt="s_N^2 = \frac{1}{N} \sum_{i=1}^N \left ( x_i - \bar{x} \right )^2 = \left (
\frac{1}{N} \sum_{i=1}^N x_i^2 \right ) - \bar{x}^2."/></p>
</div><p>This estimator is biased because its expected value is actually not equal to the
population variance:</p>
<div class="math" id="equation-biased-variance-expectation">
<p><span class="eqno">(13)</span><img src="../_images/math/61a4f1b9873d704b7cf45fbf468cb85ed94ab9e4.png" alt="E[s_N^2] = \frac{N - 1}{N} \sigma^2"/></p>
</div><p>where <img class="math" src="../_images/math/93c29bfedc993de115781b4fbb7e3a8b9e8d6b51.png" alt="\sigma^2"/> is the actual population variance. As a result, this
estimator should not be used in practice. Instead, one can use <a class="reference external" href="http://en.wikipedia.org/wiki/Bessel's_correction">Bessel&#8217;s
correction</a> to come up with an unbiased sample variance estimator:</p>
<div class="math" id="equation-unbiased-variance">
<p><span class="eqno">(14)</span><img src="../_images/math/3bd595c5a1859986ab97449768ca7259b5285aff.png" alt="s^2 = \frac{1}{N - 1} \sum_{i=1}^N \left ( x_i - \bar{x} \right )^2 =
\frac{1}{N - 1} \left ( \sum_{i=1}^N x_i^2 - N\bar{x}^2 \right )."/></p>
</div><p>This is the estimator normally used to calculate sample variance. The final form
in equation <a href="#equation-unbiased-variance">(14)</a> is especially suitable for computation since
we do not need to store the values at every realization of the random variable
as the simulation proceeds. Instead, we can simply keep a running sum and sum of
squares of the values at each realization of the random variable and use that to
calculate the variance.</p>
</div>
<div class="section" id="variance-of-the-mean">
<h4>6.4.3.3. Variance of the Mean<a class="headerlink" href="#variance-of-the-mean" title="Permalink to this headline">¶</a></h4>
<p>The previous sections discussed how to estimate the mean and variance of a
random variable using statistics on a finite sample. However, we are generally
not interested in the <em>variance of the random variable</em> itself; we are more
interested in the <em>variance of the estimated mean</em>. The sample mean is the
result of our simulation, and the variance of the sample mean will tell us how
confident we should be in our answers.</p>
<p>Fortunately, it is quite easy to estimate the variance of the mean if we are
able to estimate the variance of the random variable. We start with the
observation that if we have a series of uncorrelated random variables, we can
write the variance of their sum as the sum of their variances:</p>
<div class="math" id="equation-bienayme-formula">
<p><span class="eqno">(15)</span><img src="../_images/math/3836265d1098b6007f04935452185487bab6c384.png" alt="\text{Var} \left ( \sum_{i=1}^N X_i \right ) = \sum_{i=1}^N \text{Var} \left
( X_i \right )"/></p>
</div><p>This result is known as the Bienaymé formula. We can use this result to
determine a formula for the variance of the sample mean. Assuming that the
realizations of our random variable are again identical,
independently-distributed samples, then we have that</p>
<div class="math" id="equation-sample-variance-mean">
<p><span class="eqno">(16)</span><img src="../_images/math/d971219eaf1c78d962f294a33a761847fff0ad6f.png" alt="\text{Var} \left ( \bar{X} \right ) = \text{Var} \left ( \frac{1}{N}
\sum_{i=1}^N X_i \right ) = \frac{1}{N^2} \sum_{i=1}^N \text{Var} \left (
X_i \right ) = \frac{1}{N^2} \left ( N\sigma^2 \right ) =
\frac{\sigma^2}{N}."/></p>
</div><p>We can combine this result with equation <a href="#equation-unbiased-variance">(14)</a> to come up with
an unbiased estimator for the variance of the sample mean:</p>
<div class="math" id="equation-sample-variance-mean-formula">
<p><span class="eqno">(17)</span><img src="../_images/math/8fdf63846677589ea5d03113a13b9b7eec404824.png" alt="s_{\bar{X}}^2 = \frac{1}{N - 1} \left ( \frac{1}{N} \sum_{i=1}^N x_i^2 -
\bar{x}^2 \right )."/></p>
</div><p>At this point, an important distinction should be made between the estimator for
the variance of the population and the estimator for the variance of the
mean. As the number of realizations increases, the estimated variance of the
population based on equation <a href="#equation-unbiased-variance">(14)</a> will tend to the true
population variance. On the other hand, the estimated variance of the mean will
tend to zero as the number of realizations increases. A practical interpretation
of this is that the longer you run a simulation, the better you know your
results. Therefore, by running a simulation long enough, it is possible to
reduce the stochastic uncertainty to arbitrarily low levels.</p>
</div>
<div class="section" id="confidence-intervals">
<h4>6.4.3.4. Confidence Intervals<a class="headerlink" href="#confidence-intervals" title="Permalink to this headline">¶</a></h4>
<p>While the sample variance and standard deviation gives us some idea about the
variability of the estimate of the mean of whatever quantities we&#8217;ve tallied, it
does not help us interpret how confidence we should be in the results. To
quantity the reliability of our estimates, we can use <a class="reference external" href="http://en.wikipedia.org/wiki/Confidence_interval">confidence intervals</a>
based on the calculated sample variance.</p>
<p>A <img class="math" src="../_images/math/de6153ef1dccee84904f1dbac1e439589f70d375.png" alt="1-\alpha"/> confidence interval for a population parameter is defined as
such: if we repeat the same experiment many times and calculate the confidence
interval for each experiment, then <img class="math" src="../_images/math/324ce9e91c8341018aedd8d360b4b2de1f239f78.png" alt="1 - \alpha"/> percent of the calculated
intervals would encompass the true population parameter. Let <img class="math" src="../_images/math/2babce84f3bb52d0df02e8a0a2cc72df0572ae8e.png" alt="x_1, x_2,
\dots, x_N"/> be samples from a set of independent, identically-distributed random
variables each with population mean <img class="math" src="../_images/math/126e84ba38f7dece5f0ad64e929b9588b20f6440.png" alt="\mu"/> and variance
<img class="math" src="../_images/math/93c29bfedc993de115781b4fbb7e3a8b9e8d6b51.png" alt="\sigma^2"/>. The t-statistic is defined as</p>
<div class="math" id="equation-t-statistic">
<p><span class="eqno">(18)</span><img src="../_images/math/58bad4156e6d6bb080580d39f1d18decab95979b.png" alt="t = \frac{\bar{x} - \mu}{s/\sqrt{N}}"/></p>
</div><p>where <img class="math" src="../_images/math/bb3b56c1449e4ae998527d57d942a625594f2345.png" alt="\bar{x}"/> is the sample mean from equation <a href="#equation-sample-mean">(11)</a> and
<img class="math" src="../_images/math/6859317dd1b439cef34131bcd4bafee8393444e0.png" alt="s"/> is the standard deviation based on equation
<a href="#equation-unbiased-variance">(14)</a>. If the random variables <img class="math" src="../_images/math/052fd265afd6d56a7143b0bcf7232e2d86f2dc7e.png" alt="X_i"/> are
normally-distributed, then the t-statistic has a <a class="reference external" href="http://en.wikipedia.org/wiki/Student%27s_t-distribution">Student&#8217;s t-distribution</a>
with <img class="math" src="../_images/math/19f9ae9a7d789d9a8e661b478df966192038b540.png" alt="N-1"/> degrees of freedom. This implies that</p>
<div class="math" id="equation-t-probability">
<p><span class="eqno">(19)</span><img src="../_images/math/ceb34ab0bf3ee115960392819cb3a5b2d6549557.png" alt="Pr \left ( -t_{1 - \alpha/2, N - 1} \le \frac{\bar{x} - \mu}{s/\sqrt{N}} \le
t_{1 - \alpha/2, N - 1} \right ) = 1 - \alpha"/></p>
</div><p>where <img class="math" src="../_images/math/81b6dca86eb73d1748b4596e96ada934cd20e0e6.png" alt="t_{1-\alpha/2, N-1}"/> is the <img class="math" src="../_images/math/8caa65a6f1291fd47263ffe7ad6233f21f356e36.png" alt="1 - \alpha/2"/> percentile of a
t-distribution with <img class="math" src="../_images/math/19f9ae9a7d789d9a8e661b478df966192038b540.png" alt="N-1"/> degrees of freedom. Thus, the <img class="math" src="../_images/math/324ce9e91c8341018aedd8d360b4b2de1f239f78.png" alt="1 - \alpha"/>
two sided confidence interval for the sample mean is</p>
<div class="math" id="equation-two-sided-ci">
<p><span class="eqno">(20)</span><img src="../_images/math/3437e800374c9301a7eb182fdc39f77f799bcf87.png" alt="\bar{x} \pm t_{1 - \alpha/2, N-1} \frac{s}{\sqrt{N}}."/></p>
</div><p>One should be cautioned that equation <a href="#equation-two-sided-ci">(20)</a> only applies if the
<em>underlying random variables</em> are normally-distributed. In general, this may not
be true for a tally random variable &#8212; the central limit theorem guarantees
only that the sample mean is normally distributed, not the underlying random
variable. If batching is used, then the underlying random variable, which would
then be the averages from each batch, will be normally distributed as long as
the conditions of the central limit theorem are met.</p>
<p>Let us now outline the method used to calculate the percentile of the Student&#8217;s
t-distribution. For one or two degrees of freedom, the percentile can be written
analytically. For one degree of freedom, the t-distribution becomes a standard
<a class="reference external" href="http://en.wikipedia.org/wiki/Cauchy_distribution">Cauchy distribution</a> whose cumulative distribution function is</p>
<div class="math" id="equation-cauchy-cdf">
<p><span class="eqno">(21)</span><img src="../_images/math/1071c24bda8db8fe67211b4fe72174f007eaaa8c.png" alt="c(x) = \frac{1}{\pi} \arctan x + \frac{1}{2}."/></p>
</div><p>Thus, inverting the cumulative distribution function, we find the <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/>
percentile of the standard Cauchy distribution to be</p>
<div class="math" id="equation-percentile-1">
<p><span class="eqno">(22)</span><img src="../_images/math/d9dae826173271b09c2f3aef7f06bc2c1c6a85d0.png" alt="t_{x,1} = \tan \left ( \pi \left ( x - \frac{1}{2} \right ) \right )."/></p>
</div><p>For two degrees of freedom, the cumulative distribution function is the
second-degree polynomial</p>
<div class="math" id="equation-t-2-polynomial">
<p><span class="eqno">(23)</span><img src="../_images/math/9a1ee0c08a37a711d40ba9c72927c5bbe9eb1f69.png" alt="c(x) = \frac{1}{2} + \frac{x}{2\sqrt{x^2 + 2}}"/></p>
</div><p>Solving for <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/>, we find the <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> percentile to be</p>
<div class="math" id="equation-percentile-2">
<p><span class="eqno">(24)</span><img src="../_images/math/f9d907c28a8f3dfbc8322ddbb53d6b37453aad63.png" alt="t_{x,2} = \frac{2\sqrt{2} (x - 1/2)}{\sqrt{1 - 4 (x - 1/2)^2}}"/></p>
</div><p>For degrees of freedom greater than two, it is not possible to obtain an
analytical formula for the inverse of the cumulative distribution function. We
must resort to either numerically solving for the inverse or to an
approximation. Approximations for percentiles of the t-distribution have been
found with high levels of accuracy. OpenMC uses the approximation from
<a class="reference internal" href="#george" id="id2">[George]</a>:</p>
<div class="math" id="equation-percentile-n">
<p><span class="eqno">(25)</span><img src="../_images/math/2c5d546b34d454a9692e43323a500518e77a0274.png" alt="t_{x,n} = \sqrt{\frac{n}{n-2}} \left ( z_x + \frac{1}{4} \frac{z_x^3 -
3z_x}{n-2} + \frac{1}{96} \frac{5z_x^5 - 56z_x^3 + 75z_x}{(n-2)^2} +
\frac{1}{384} \frac{3z_x^7 - 81z_x^5 + 417z_x^3 - 315z_x}{(n-2)^3} \right )"/></p>
</div><p>where <img class="math" src="../_images/math/c1eff259acfe59a4e160585cfe8ce274fa1ba69f.png" alt="z_x"/> is the <img class="math" src="../_images/math/188c175aac0a8a9c22499336711b5d7256407254.png" alt="x"/> percentile of the standard normal
distribution. In order to determine an arbitrary percentile of the standard
normal distribution, we use an <a class="reference external" href="http://home.online.no/~pjacklam/notes/invnorm/">unpublished rational approximation</a>. After
using the rational approximation, one iteration of Newton&#8217;s method is applied to
improve the estimate of the percentile.</p>
<p class="rubric">References</p>
<table class="docutils citation" frame="void" id="george" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[George]</a></td><td>E. E. Olusegun George and Meenakshi Sivaram, &#8220;A modification of the
Fisher-Cornish approximation for the student t percentiles,&#8221; Communication
in Statistics - Simulation and Computation, 16 (4), pp. 1123-1132 (1987).</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="physics.html">5. Physics</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="eigenvalue.html">7. Eigenvalue Calculations</a>&#160;&#160;»
        </p>

      </div>


    <div class="footer" role="contentinfo">
        &copy; Copyright 2011-2015, Massachusetts Institute of Technology.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30411614-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>