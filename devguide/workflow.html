<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>3. Development Workflow &mdash; OpenMC Documentation</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="OpenMC Documentation" href="../index.html" />
    <link rel="up" title="Developer’s Guide" href="index.html" />
    <link rel="next" title="4. XML Input Parsing" href="xml-parsing.html" />
    <link rel="prev" title="2. Style Guide for OpenMC" href="styleguide.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner">
        <a href="../index.html">
          <img class="logo" src="../_static/openmc.png" alt="Logo"/>
        </a>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="styleguide.html">2. Style Guide for OpenMC</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="xml-parsing.html">4. XML Input Parsing</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="development-workflow">
<span id="devguide-workflow"></span><h1>3. Development Workflow<a class="headerlink" href="#development-workflow" title="Permalink to this headline">¶</a></h1>
<p>Anyone wishing to make contributions to OpenMC should be fully acquianted and
comfortable working with <a class="reference external" href="http://git-scm.com/">git</a> and <a class="reference external" href="https://github.com/">GitHub</a>. We assume here that you have git
installed on your system, have a GitHub account, and have setup SSH keys to be
able to create/push to repositories on GitHub.</p>
<div class="section" id="overview">
<h2>3.1. Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Development of OpenMC relies heavily on branching; specifically, we use a
branching model sometimes referred to as <a class="reference external" href="http://nvie.com/git-model">git flow</a>. If you plan to contribute
to OpenMC development, we highly recommend that you read the linked blog post to
get a sense of how the branching model works. There are two main branches that
always exist: <em>master</em> and <em>develop</em>. The <em>master</em> branch is a stable branch
that contains the latest release of the code. The <em>develop</em> branch is where any
ongoing development takes place prior to a release and is not guaranteed to be
stable. When the development team decides that a release should occur, the
<em>develop</em> branch is merged into <em>master</em>.</p>
<p>Trivial changes to the code may be committed directly to the <em>develop</em> branch by
a trusted developer. However, most new features should be developed on a branch
that branches off of <em>develop</em>. When the feature is completed, a <a class="reference external" href="https://help.github.com/articles/using-pull-requests">pull request</a>
is initiated on GitHub that is then reviewed by a trusted developer. If the pull
request is satisfactory, it is then merged into <em>develop</em>. Note that a trusted
developer may not review their own pull request (i.e., an independent code
review is required).</p>
</div>
<div class="section" id="code-review-criteria">
<h2>3.2. Code Review Criteria<a class="headerlink" href="#code-review-criteria" title="Permalink to this headline">¶</a></h2>
<p>In order to be considered suitable for inclusion in the <em>develop</em> branch, the
following criteria must be satisfied for all proposed changes:</p>
<ul class="simple">
<li>Changes have a clear purpose and are useful.</li>
<li>Compiles under all conditions (MPI, OpenMP, HDF5, etc.).  This is checked as
part of the test suite.</li>
<li>Passes the regression suite.</li>
<li>If appropriate, test cases are added to regression suite.</li>
<li>No memory leaks (checked with <a class="reference external" href="http://valgrind.org/">valgrind</a>).</li>
<li>Conforms to the OpenMC <a class="reference external" href="http://mit-crpg.github.io/openmc/devguide/styleguide.html">style guide</a>.</li>
<li>No degradation of performance or greatly increased memory usage. This is not a
hard rule &#8211; in certain circumstances, a performance loss might be acceptable
if there are compelling reasons.</li>
<li>New features/input are documented.</li>
<li>No unnecessary external software dependencies are introduced.</li>
</ul>
</div>
<div class="section" id="contributing">
<h2>3.3. Contributing<a class="headerlink" href="#contributing" title="Permalink to this headline">¶</a></h2>
<p>Now that you understand the basic development workflow, let&#8217;s discuss how an
individual to contribute to development. Note that this would apply to both new
features and bug fixes. The general steps for contributing are as follows:</p>
<ol class="arabic">
<li><p class="first">Fork the main openmc repository from <a class="reference external" href="https://github.com/mit-crpg/openmc">mit-crpg/openmc</a>. This will create a
repository with the same name under your personal account. As such, you can
commit to it as you please without disrupting other developers.</p>
<img alt="../_images/fork.png" src="../_images/fork.png" />
</li>
<li><p class="first">Clone your fork of OpenMC and create a branch that branches off of <em>develop</em>:</p>
<div class="highlight-sh"><div class="highlight"><pre>git clone git@github.com:yourusername/openmc.git
<span class="nb">cd </span>openmc
git checkout -b newbranch develop
</pre></div>
</div>
</li>
<li><p class="first">Make your changes on the new branch that you intend to have included in
<em>develop</em>. If you have made other changes that should not be merged back,
ensure that those changes are made on a different branch.</p>
</li>
<li><p class="first">Issue a pull request from GitHub and select the <em>develop</em> branch of
mit-crpg/openmc as the target.</p>
<img alt="../_images/pullrequest.png" src="../_images/pullrequest.png" />
<p>At a minimum, you should describe what the changes you&#8217;ve made are and why
you are making them. If the changes are related to an oustanding issue, make
sure it is cross-referenced. A wise developer would also check whether their
changes do indeed pass the regression test suite.</p>
</li>
<li><p class="first">A trusted developer will review your pull request based on the criteria
above. Any issues with the pull request can be discussed directly on the pull
request page itself.</p>
</li>
<li><p class="first">After the pull request has been thoroughly vetted, it is merged back into the
<em>develop</em> branch of mit-crpg/openmc.</p>
</li>
</ol>
</div>
<div class="section" id="openmc-test-suite">
<span id="test-suite"></span><h2>3.4. OpenMC Test Suite<a class="headerlink" href="#openmc-test-suite" title="Permalink to this headline">¶</a></h2>
<p>The purpose of this test suite is to ensure that OpenMC compiles using various
combinations of compiler flags and options, and that all user input options can
be used successfully without breaking the code. The test suite is comprised of
regression tests where different types of input files are configured and the
full OpenMC code is executed. Results from simulations are compared with
expected results. The test suite is comprised of many build configurations
(e.g. debug, mpi, hdf5) and the actual tests which reside in sub-directories
in the tests directory. We recommend to developers to test their branches
before submitting a formal pull request using gfortran and intel compilers
if available.</p>
<p>The test suite is designed to integrate with cmake using <a class="reference external" href="http://www.cmake.org/cmake/help/v2.8.12/ctest.html">ctest</a>.
It is configured to run with cross sections from <a class="reference external" href="http://http://www.nndc.bnl.gov/endf/b7.1/acefiles.html">NNDC</a>. To
download these cross sections please do the following:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nb">cd</span> ../data
python get_nndc_data.py
<span class="nb">export </span><span class="nv">CROSS_SECTIONS</span><span class="o">=</span>&lt;path_to_data_folder&gt;/nndc/cross_sections.xml
</pre></div>
</div>
<p>The test suite can be run on an already existing build using:</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nb">cd </span>build
make <span class="nb">test</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-sh"><div class="highlight"><pre><span class="nb">cd </span>build
ctest
</pre></div>
</div>
<p>There are numerous <a class="reference external" href="http://www.cmake.org/cmake/help/v2.8.12/ctest.html">ctest</a> command line options that can be set to have
more control over which tests are executed.</p>
<p>Before running the test suite python script, the following environmental
variables should be set if the default paths are incorrect:</p>
<blockquote>
<div><ul>
<li><p class="first"><strong>FC</strong> - The command of the Fortran compiler (e.g. gfotran, ifort).</p>
<blockquote>
<div><ul class="simple">
<li>Default - <em>gfortran</em></li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>MPI_DIR</strong> - The path to the MPI directory.</p>
<blockquote>
<div><ul class="simple">
<li>Default - <em>/opt/mpich/3.1.3-gnu</em></li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>HDF5_DIR</strong> - The path to the HDF5 directory.</p>
<blockquote>
<div><ul class="simple">
<li>Default - <em>/opt/hdf5/1.8.14-gnu</em></li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>PHDF5_DIR</strong> - The path to the parallel HDF5 directory.</p>
<blockquote>
<div><ul class="simple">
<li>Default - <em>/opt/phdf5/1.8.14-gnu</em></li>
</ul>
</div></blockquote>
</li>
</ul>
</div></blockquote>
<p>To run the full test suite, the following command can be executed in the
tests directory:</p>
<div class="highlight-sh"><div class="highlight"><pre>python run_tests.py
</pre></div>
</div>
<p>A subset of build configurations and/or tests can be run. To see how to use
the script run:</p>
<div class="highlight-sh"><div class="highlight"><pre>python run_tests.py --help
</pre></div>
</div>
<p>As an example, say we want to run all tests with debug flags only on tests
that have cone and plot in their name. Also, we would like to run this on
4 processors. We can run:</p>
<div class="highlight-sh"><div class="highlight"><pre>python run_tests.py -j <span class="m">4</span> -C debug -R <span class="s2">&quot;cone|plot&quot;</span>
</pre></div>
</div>
<p>Note that standard regular expression syntax is used for selecting build
configurations and tests. To print out a list of build configurations, we
can run:</p>
<div class="highlight-sh"><div class="highlight"><pre>python run_tests.py -p
</pre></div>
</div>
<div class="section" id="adding-tests-to-test-suite">
<h3>3.4.1. Adding tests to test suite<a class="headerlink" href="#adding-tests-to-test-suite" title="Permalink to this headline">¶</a></h3>
<p>To add a new test to the test suite, create a sub-directory in the tests
directory that conforms to the regular expression <em>test_</em>. To configure
a test you need to add the following files to your new test directory,
<em>test_name</em> for example:</p>
<blockquote>
<div><ul class="simple">
<li>OpenMC input XML files</li>
<li><strong>test_name.py</strong> - python test driver script, please refer to other
tests to see how to construct. Any output files that are generated
during testing must be removed at the end of this script.</li>
<li><strong>results.py</strong> - python script that extracts results from statepoint
output files. By default it should look for a binary file, but can
take an argument to overwrite which statepoint file is processed,
whether it is at a different batch or with an HDF5 extension. This
script must output a results file that is named <em>results_test.dat</em>.
It is recommended that any real numbers reported use <em>12.6E</em> format.</li>
<li><strong>results_true.dat</strong> - ASCII file that contains the expected results
from the test. The file <em>results_test.dat</em> is compared to this file
during the execution of the python test driver script. When the
above files have been created, generate a <em>results_test.dat</em> file and
copy it to this name and commit. It should be noted that this file
should be generated with basic compiler options during openmc
configuration and build (e.g., no MPI/HDF5, no debug/optimization).</li>
</ul>
</div></blockquote>
<p>In addition to this description, please see the various types of tests that
are already included in the test suite to see how to create them. If all is
implemented correctly, the new test directory will automatically be added
to the CTest framework.</p>
</div>
</div>
<div class="section" id="private-development">
<h2>3.5. Private Development<a class="headerlink" href="#private-development" title="Permalink to this headline">¶</a></h2>
<p>While the process above depends on the fork of the OpenMC repository being
publicly available on GitHub, you may also wish to do development on a private
repository for research or commercial purposes. The proper way to do this is to
create a complete copy of the OpenMC repository (not a fork from GitHub). The
private repository can then either be stored just locally or in conjunction with
a private repository on Github (this requires a <a class="reference external" href="https://github.com/plans">paid plan</a>). Alternatively,
<a class="reference external" href="https://bitbucket.org">Bitbucket</a> offers private repositories for free. If you want to merge some
changes you&#8217;ve made in your private repository back to mit-crpg/openmc
repository, simply follow the steps above with an extra step of pulling a branch
from your private repository into a public fork.</p>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="styleguide.html">2. Style Guide for OpenMC</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="xml-parsing.html">4. XML Input Parsing</a>&#160;&#160;»
        </p>

      </div>


    <div class="footer" role="contentinfo">
        &copy; Copyright 2011-2015, Massachusetts Institute of Technology.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30411614-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>