<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>4. XML Input Parsing &mdash; OpenMC Documentation</title>
    
    <link rel="stylesheet" href="../_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.6.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="top" title="OpenMC Documentation" href="../index.html" />
    <link rel="up" title="Developer’s Guide" href="index.html" />
    <link rel="next" title="5. State Point Binary File Specifications" href="statepoint.html" />
    <link rel="prev" title="3. Development Workflow" href="workflow.html" /> 
  </head>
  <body>
      <div class="header">
        <a href="../index.html">
          <img class="logo" src="../_static/openmc.png" alt="Logo"/>
        </a>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="workflow.html">3. Development Workflow</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="statepoint.html">5. State Point Binary File Specifications</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="xml-input-parsing">
<span id="devguide-xml-parsing"></span><h1>4. XML Input Parsing<a class="headerlink" href="#xml-input-parsing" title="Permalink to this headline">¶</a></h1>
<p>OpenMC relies on the <a class="reference external" href="https://github.com/mit-crpg/fox">FoX</a> Fortran XML library for reading and intrepreting the
XML input files for geometry, materials, settings, tallies, etc. The use of an
XML format makes writing input files considerably more flexible than would
otherwise be possible.</p>
<p>With the FoX library, extending the user input files to include new tags is
fairly straightforward. The steps for modifying/adding input are as follows:</p>
<ol class="arabic simple">
<li>Add appropriate calls to procedures from the <a class="reference external" href="https://github.com/mit-crpg/openmc/blob/develop/src/xml_interface.F90">xml_interface module</a>, such as
<tt class="docutils literal"><span class="pre">check_for_node</span></tt>, <tt class="docutils literal"><span class="pre">get_node_value</span></tt>, and <tt class="docutils literal"><span class="pre">get_node_array</span></tt>. All input
reading is performed in the <a class="reference external" href="https://github.com/mit-crpg/openmc/blob/develop/src/input_xml.F90">input_xml module</a>.</li>
<li>Make sure that your input can be categorized as one of the datatypes from
<a class="reference external" href="http://www.w3.org/TR/xmlschema-2/">XML Schema Part 2</a> and that parsing of the data appropriately reflects
this. For example, for a <a class="reference external" href="http://www.w3.org/TR/xmlschema-2/#boolean">boolean</a> value, true can be represented either by
&#8220;true&#8221; or by &#8220;1&#8221;.</li>
<li>Add code to check the variable for any possible errors.</li>
</ol>
<p>A set of <a class="reference external" href="http://relaxng.org/">RELAX NG</a> schemata exists that enables real-time validation of input
files when using the GNU Emacs text editor. You should also modify the RELAX NG
schema for the file you changed (e.g. src/relaxng/geometry.rnc) so that
those who use Emacs can confirm whether their input is valid before they
run. You will need to be familiar with RELAX NG <a class="reference external" href="http://relaxng.org/compact-tutorial-20030326.html">compact syntax</a>.</p>
<div class="section" id="working-with-the-fox-submodule">
<h2>4.1. Working with the FoX Submodule<a class="headerlink" href="#working-with-the-fox-submodule" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference external" href="https://github.com/mit-crpg/fox">FoX</a> library is included as a <a class="reference external" href="http://git-scm.com/book/en/Git-Tools-Submodules">submodule</a> in OpenMC. This means that for a
given commit in OpenMC, there is an associated commit id that links to FoX.
The actual FoX source code is maintained at mit-crpg/fox, branch openmc. When
cloning the OpenMC repo for the first time, you will notice that the directory
<em>src/xml/fox</em> is empty. To fetch the submodule source code, you can manually
enter the following from the root directory of OpenMC:</p>
<div class="highlight-sh"><div class="highlight"><pre>git submodule init
git submodule update
</pre></div>
</div>
<p>It should be noted that if the submodule is not initialized and updated, <em>cmake</em>
will automatically perform these commands if it cannot file the FoX source code.</p>
<p>If you navigate into the FoX source code in OpenMC, src/xml/fox, and check git
information, you will notice that you are in a completely different repo. Actually,
you are in a clone of mit-crpg/fox. If you have write access to this repo, you can
make changes to the FoX source code, commit and push just like any other repo.
Just because you make changes to the FoX source code in OpenMC or in a standalone
repo, this does not mean that OpenMC will automatically fetch these changes. The
way submodules work is that they are just stored as a commit id. To save FoX xml
source changes to your OpenMC branch, do the following:</p>
<ol class="arabic simple">
<li>Go into src/xml/fox and check out the appropriate source code state</li>
<li>Navigate back out of fox subdirectory and type:</li>
</ol>
<div class="highlight-sh"><div class="highlight"><pre>git status
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Make sure you see that git recognized that the state of FoX changed:</li>
</ol>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># On branch fox_submodule</span>
<span class="c"># Changes not staged for commit:</span>
<span class="c">#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="c">#   (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="c">#</span>
<span class="c">#   modified:   fox (new commits)</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Commit and push this change</li>
</ol>
</div>
<div class="section" id="editing-fox-on-personal-fork">
<h2>4.2. Editing FoX on Personal Fork<a class="headerlink" href="#editing-fox-on-personal-fork" title="Permalink to this headline">¶</a></h2>
<p>If you don&#8217;t have write access to mit-crpg/fox and thus can&#8217;t make a branch off of the openmc
branch there, you will need to fork mit-crpg/fox to your personal account. You need to then
link your branch in your OpenMC repo, to the <em>openmc</em> branch on your own personal FoX fork.
To do this, edit the <em>.gitmodules</em> file in the root folder of the repo. It contains the
following information:</p>
<div class="highlight-python"><pre>[submodule "src/xml/fox"]
    path = src/xml/fox
    url = git@github.com:mit-crpg/fox</pre>
</div>
<p>Change the url remote to your own fork. The commit id should stay constant until you start
making modification to FoX yourself. Once you have made changes to your FoX fork and linked
the new commit id to your OpenMC branch, you can pull request your changes in by peforming
the following steps:</p>
<ol class="arabic simple">
<li>Create a pull request from your fork of FoX to mit-crpg/fox and wait until it
is merged into the openmc branch.</li>
<li>In your OpenMC repo, change your <em>.gitmodules</em> file back to point at mit-crpg/fox.</li>
<li>Submit a pull request to mit-crpg/openmc</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If you make changes to your FoX submodule inside of an OpenMC repo and do not
commit, do <strong>not</strong> run <em>git submodule update</em>. This may throw away any changes that
were not committed.</p>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="workflow.html">3. Development Workflow</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="statepoint.html">5. State Point Binary File Specifications</a>&#160;&#160;»
        </p>

      </div>


    <div class="footer">
        &copy; Copyright 2011-2014, Massachusetts Institute of Technology.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.
    </div>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30411614-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </body>
</html>